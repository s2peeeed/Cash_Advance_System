;/*FB_PKG_DELIM*/

__d("CometMarketplaceConfirmMarkAsPaidDialogQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9643878485689642"}),null);
__d("LSFetchBanners",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("thread_key",a[0]),d[1]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTask"),"in_thread_banner_fetch_activity_banners_queue",c.i64.cast([0,72]),d[1],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}a.__sproc_name__="LSInThreadBannerFetchBannersStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSPlatformLockState",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({Waiting:"waiting",Acquired:"acquired",Cleaning:"cleaning",Canceled:"canceled"});f.LockState=a}),66);
__d("MessengerLocksManagerFallback",["MWLocalStorageErrorHandler","WebStorageLockManager"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("WebStorageLockManager").make(a,{onQuotaExceeded:d("MWLocalStorageErrorHandler").onQuotaExceeded})}g["default"]=a}),98);
__d("ReStoreNameUtils",["CurrentMessengerUser"],(function(a,b,c,d,e,f,g){"use strict";a=d("CurrentMessengerUser").getIDorEIMU();b="RestoreIDBMainLock-"+a;c="dbLock-"+a;e="RestoreConcurrency-"+a;f="lsPlatformLock-"+a;d="syncLock-"+a;a="single-instance-pdb-"+a;g.reStoreCMLockName=b;g.reStoreDBLockName=c;g.restoreConcurrencyBroadcastChannelName=e;g.lsPlatformLockBroadcastChannelName=f;g.lsPlatformLockName=d;g.singleTabLockName=a}),98);
__d("saveHandler",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c={};a.set(c,b);return function(){a["delete"](c)}}f["default"]=a}),66);
__d("LSPlatformSyncLock",["BrowserLockManager","FBLogger","LSPlatformErrorChannel","LSPlatformLockState","LSPlatformLsInitLog","MWBroadcastChannel","MessengerLocksManagerFallback","MessengerLogHistory","ReStoreNameUtils","Run","clearTimeout","emptyFunction","gkx","justknobx","pageID","promiseDone","saveHandler","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h=d("MessengerLogHistory").getInstance("client_init"),i=typeof window!=="undefined"?window:self,j="iwantlock",k="lockRequestOnDemand";e="mw_msgr_mutex";function l(a,b){a===void 0&&(a=i);b===void 0&&(b=function(){return document.hasFocus()});var e=new Map(),f=new Map(),g=d("LSPlatformLockState").LockState.Waiting,l=c("emptyFunction"),m,n=c("gkx")("24155")?d("MWBroadcastChannel").MWBroadcastChannel(d("ReStoreNameUtils").lsPlatformLockBroadcastChannelName):void 0,o=function(){if(!c("gkx")("24155"))return;m!=null&&c("clearTimeout")(m);if(g===d("LSPlatformLockState").LockState.Canceled||g===d("LSPlatformLockState").LockState.Acquired)return;m=c("setTimeout")(function(){b()&&g!==d("LSPlatformLockState").LockState.Acquired&&(h.debug("tab has focus and wants to acquire sync lock"),n==null?void 0:n.postMessage(j))},c("justknobx")._("1764"))};async function p(){h.debug("Sync lock acquired"),g=d("LSPlatformLockState").LockState.Acquired,await Promise.all(Array.from(e.values()).map(function(a){return a()}))}function q(){g=d("LSPlatformLockState").LockState.Cleaning,l=c("emptyFunction"),f.forEach(function(a){return a()})}function r(){var e=new AbortController(),f=c("LSPlatformErrorChannel").subscribe(function(b){h.debug("syncLock aborted due to ["+b.name+"] "+b.message),c("FBLogger")("messenger_web").info("[LS] SyncLock aborted due to [%s] %s",b.name,b.message),l(),e.abort(),g=d("LSPlatformLockState").LockState.Canceled,n==null?void 0:n.removeEventListener("message",i),a.removeEventListener("focus",o),f()}),i=function a(i){if(i==null||i.data==null||(i.data!==j||b())&&i.data!==k)return;h.debug("got message from other tab to abort request to sync lock");l();e.abort();f();n==null?void 0:n.removeEventListener("message",a);g=d("LSPlatformLockState").LockState.Waiting;c("promiseDone")(s())};n==null?void 0:n.addEventListener("message",i);return e}async function s(){var a=c("BrowserLockManager")!=null?c("BrowserLockManager"):c("MessengerLocksManagerFallback")(c("pageID"));if(a){g=d("LSPlatformLockState").LockState.Waiting;d("LSPlatformLsInitLog").addPoint("sync_lock_start");h.debug("Sync lock requested if available");await new Promise(function(b){return a.request(d("ReStoreNameUtils").lsPlatformLockName,{ifAvailable:!0},async function(a){if(a==null){h.debug("Attempted to acquire sync lock but it already taken");d("LSPlatformLsInitLog").addPoint("sync_lock_unavailable");b();return}h.debug("Attempted to acquire sync lock and suceeded");await p();d("LSPlatformLsInitLog").addPoint("sync_lock_acquired");b();return new Promise(function(a){l=function(){h.debug("Releasing sync lock"),q(),a()}})})});var b=r();g!==d("LSPlatformLockState").LockState.Acquired&&(h.debug("Sync lock requested and will wait"),d("LSPlatformLsInitLog").addPoint("sync_lock_requests_again"),c("promiseDone")(a.request(d("ReStoreNameUtils").lsPlatformLockName,{signal:b.signal},async function(a){h.debug("Previous attempt to get sync lock failed, getting in queue for when/if it becomes available");await p();return new Promise(function(a){l=function(){h.debug("Releasing sync lock"),q(),a()}})}),function(a){},function(a){if((a==null?void 0:a.name)==="AbortError")h.debug("Aborting attempt to acquire sync lock");else{d("LSPlatformLsInitLog").addPoint("sync_lock_request_failure");throw a}}));d("LSPlatformLsInitLog").addPoint("lock_requested")}else{d("LSPlatformLsInitLog").addPoint("sync_lock_end_failure");throw c("FBLogger")("ls_web_init").mustfixThrow("No lock manager inited")}}n!=null&&(a.addEventListener("focus",o),o(),d("LSPlatformLsInitLog").addPoint("onfocus_set"));d("Run").onBeforeUnload(function(){l()},!1);d("LSPlatformLsInitLog").addPoint("beforeunload_set");return{_getStateInternal:function(){return g},hasLock:function(){return g===d("LSPlatformLockState").LockState.Acquired},onAcquired:function(a){return c("saveHandler")(e,a)},onLost:function(a){return c("saveHandler")(f,a)},onLostOnce:function(a){var b=c("saveHandler")(f,function(){a(),b()})},release:function(){l()},requestLock:s}}var m=null;function a(){m==null&&(m=l());return m}function b(){m!=null&&m.release()}g.SYNC_KEY=e;g.init=l;g.use=a;g.releaseIfExist=b}),98);
__d("LSReceiveMarkThreadReadNative",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(9).fetch([[[a[0]]]]).next().then(function(a,b){var d=a.done;a=a.value;return d?c[0]=void 0:(b=a.item,c[0]=b.lastReadWatermarkTimestampMs)})},function(d){return b.i64.neq(c[0],void 0)&&b.i64.neq(a[1],void 0)&&b.i64.gt(a[1],c[0])?c[2]=a[1]:c[2]=void 0,b.i64.neq(c[2],void 0)?b.sequence([function(d){return b.forEach(b.db.table(9).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({lastReadWatermarkTimestampMs:c[2]})})},function(a){return c[3]=c[2]}]):b.resolve(c[3]=void 0)},function(a){return d[0]=c[3]}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxReceiveMarkThreadReadNativeStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("LSWriteCTAIdToThreadsTable",["LSGetFirstAvailableAttachmentCTAID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return a[1]===void 0?c.forEach(c.filter(c.db.table(9).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&(c.i64.neq(b.lastMessageCtaId,void 0)||b.lastMessageCtaType!==void 0)}),function(b){var c=b.update;b.item;return c({lastMessageCtaId:void 0,lastMessageCtaType:void 0,lastMessageCtaTimestampMs:a[2]})}):c.i64.neq(a[2],void 0)?c.sequence([function(b){return c.db.table(9).fetch([[[a[0]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[0]=c.i64.cast([0,0]):(b=a.item,d[0]=b.lastActivityTimestampMs)})},function(e){return c.i64.ge(a[2],d[0])?c.sequence([function(a){return c.storedProcedure(b("LSGetFirstAvailableAttachmentCTAID")).then(function(a){return a=a,d[2]=a[0],a})},function(b){return c.forEach(c.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({lastMessageCtaId:d[2],lastMessageCtaType:a[1],lastMessageCtaTimestampMs:a[2]})})}]):c.resolve(0)}]):c.resolve()},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxWriteCTAIdToThreadsTableStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("ReStoreErrorAction",["ClientConsistencyEventEmitter","LSPlatformSyncLock","MAWCurrentUser"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(d("MAWCurrentUser").getAppID()){case 772021112871879:c("ClientConsistencyEventEmitter").emit("hardRefresh",a);break;default:h(a)}}function h(a){c("ClientConsistencyEventEmitter").emit("softRefresh",a)}function b(){d("LSPlatformSyncLock").releaseIfExist()}g.refresh=a;g.softRefresh=h;g.stopClient=b}),98);
__d("ReStoreDbVersionChange",["ReStoreErrorAction"],(function(a,b,c,d,e,f,g){"use strict";var h="LS DB changed version",i="ReStoreDbVersionChange";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c=h;b=a.call(this,c)||this;b.message=c;b.name=i;d("ReStoreErrorAction").stopClient();d("ReStoreErrorAction").refresh("restore_versionchange");return b}return b}(babelHelpers.wrapNativeSuper(Error));g.ERROR_NAME=i;g.ReStoreDbVersionChange=a}),98);