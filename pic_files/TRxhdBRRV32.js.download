;/*FB_PKG_DELIM*/

__d("IEBAPI",["MAWBridge"],(function(a,b,c,d,e,f,g){"use strict";c=1;function a(a){return function(){for(var b=arguments.length,c=new Array(b),e=0;e<b;e++)c[e]=arguments[e];return d("MAWBridge").getBridge().sendAndReceive("backend","ebapi",{args:c,type:a})}}function b(a){return function(){for(var b=arguments.length,c=new Array(b),e=0;e<b;e++)c[e]=arguments[e];return d("MAWBridge").getBridge().sendAndReceive("backend","minosEBAPI",{args:c,type:a})}}g.version=c;g.makeBridgedApi=a;g.makeMinosBridgedApi=b}),98);
__d("EBMinosBridgedAPI",["IEBAPI"],(function(a,b,c,d,e,f,g){"use strict";a={minosVerifySingleEpoch:d("IEBAPI").makeMinosBridgedApi("minosVerifySingleEpoch"),writeMinosMailboxKeysForRecipient:d("IEBAPI").makeMinosBridgedApi("writeMinosMailboxKeysForRecipient")};b=a;g["default"]=b}),98);
__d("EBMinosVerifySingleEpoch",["EBMinosBridgedAPI","I64"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b,e,f,g,i,j){a=await c("EBMinosBridgedAPI").minosVerifySingleEpoch({minosEpochAnonId:a,minosMailboxAuthPublicKey:g,minosMailboxEncryptionPublicKey:f,minosMailboxSigningPublicKey:e,previousEpochHead:i,selfEpochSignature:j,userId:(h||(h=d("I64"))).to_string(b)});return Promise.resolve([a])}g.minosVerifySingleEpoch=a}),98);
__d("EBSMDBCleanupAPI",["EBMainThreadEBDBApiDeferred","EBSMDBAPI","MAWIndexedDbMetadata","Promise","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a==null&&c("promiseDone")(d("EBMainThreadEBDBApiDeferred").clearWorkerState());a=(h||(h=b("Promise"))).all([d("EBSMDBAPI").deleteEBIDB(),d("EBSMDBAPI").deleteEBIDB(d("MAWIndexedDbMetadata").EBSM_WORKER_DB_PREFIX)]).then(function(){});return a}g.cleanupStateTables=a}),98);
__d("EBWriteMinosMailboxKeysToCache",["EBMinosBridgedAPI","I64","WALongInt","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b,e,f,g,i,j,k,l,m){await c("EBMinosBridgedAPI").writeMinosMailboxKeysForRecipient({id:(h||(h=d("I64"))).to_string(a),minosEncryptionPublicKey:f,minosEpochAnonId:b,minosEpochHead:g,minosEpochHeadCreationTime:e!=null?d("WATimeUtils").castLongIntToUnixTime(d("WALongInt").decimalStringToLongInt((h||(h=d("I64"))).to_string(e))):void 0,minosEpochSignatureSelf:j,minosMailboxAuthPubKey:k,minosMailboxSigningPubKey:l,minosPreviousEpochHead:m,minosPublicKeyFBID:i!=null?(h||(h=d("I64"))).to_string(i):void 0});return Promise.resolve()}g.writeMinosMailboxKeysToCache=a}),98);
__d("EncryptedBackupUploadFailureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5728");b=d("FalcoLoggerInternal").create("encrypted_backup_upload_failure",a);e=b;g["default"]=e}),98);
__d("XPlatReactVoprf.shared",[],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,b)||this;c.message=b;return c}return b}(babelHelpers.wrapNativeSuper(Error));f.VoprfWasmError=a}),66);
__d("mapVoprfWasmError",["XPlatReactVoprf.shared"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case-1:return new h();case 1:return new i();case 2:return new j();case 3:return new k();case 4:return new l();default:return new m()}}var h=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a===void 0&&(a="Unknown error encountered by VOPRF WASM");a=b.call(this,a)||this;a.name="VoprfUnknownError";return a}return a}((b=d("XPlatReactVoprf.shared")).VoprfWasmError),i=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a===void 0&&(a="Incorrect buffer length encountered by VOPRF WASM");a=b.call(this,a)||this;a.name="VoprfBufferLengthError";return a}return a}(b.VoprfWasmError),j=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a===void 0&&(a="Error while performing curve operation by VOPRF WASM");a=b.call(this,a)||this;a.name="VoprfCurveOperationError";return a}return a}(b.VoprfWasmError),k=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a===void 0&&(a="Error while performing hash operation by VOPRF WASM");a=b.call(this,a)||this;a.name="VoprfHashOperationError";return a}return a}(b.VoprfWasmError),l=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a===void 0&&(a="Error while performing proof operation by VOPRF WASM");a=b.call(this,a)||this;a.name="VoprfProofError";return a}return a}(b.VoprfWasmError),m=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a===void 0&&(a="Unknown error code received from WASM binary");a=b.call(this,a)||this;a.name="UnknownErrorCode";return a}return a}(b.VoprfWasmError);g.mapVoprfWasmError=a;g.VoprfUnknownError=h;g.VoprfBufferLengthError=i;g.VoprfCurveOperationError=j;g.VoprfHashOperationError=k;g.VoprfProofError=l;g.UnknownErrorCode=m}),98);
__d("LSVoprfWasmBuilder",["FBLogger","err","mapVoprfWasmError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return function(b){var d=b.locateFile!=null?{locateFile:b.locateFile}:{instantiateWasm:async function(a,d){try{var e=await b.getWasmModule();e=await WebAssembly.instantiate(e,a);d(e);return{}}catch(a){c("FBLogger")("LSVoprfWasmBuilder").mustfix("instantiateWasm failed with error: %s",a.toString());return!1}}};return h(d,a)}}function h(a,b){return new Promise(function(e,f){b(a).then(function(a){var b=a._sodiumInit();b!==0&&f(c("err")("Failed to initialize Sodium!"));e({createCurveRistretto:function(){var b;try{b=a._curve_create();a._curve_init_ristretto(b);return b}catch(c){b!=null&&a._curve_free(b);throw c}},freeCurve:function(b){a._curve_free(b)},createVoprfExpTwohashdh:function(b){var c;try{c=a._voprf_create();a._voprf_init_exp_twohashdh(c,b);return c}catch(b){c!=null&&a._voprf_free(c);throw b}},freeVoprf:function(b){a._voprf_free(b)},getCurveBytes:function(b){return a._get_curve_element_bytes(b.curvePtr)},getCurveScalarBytes:function(b){return a._get_curve_scalar_bytes(b.curvePtr)},blind:function(b,c){var e,f,g;try{var h=a._get_curve_element_bytes(b.curvePtr),k=a._get_curve_scalar_bytes(b.curvePtr);e=a._malloc(h);f=a._malloc(k);g=j(a,c);b=a._blind(b.voprfPtr,e,h,f,k,g,c.length);if(b!==0)throw d("mapVoprfWasmError").mapVoprfWasmError(b);c=i(a,e,h);b=i(a,f,k);return{blindedElement:c,blindingFactor:b}}finally{[e,f,g].forEach(function(b){b!=null&&a._free(b)})}},verifiableUnblind:function(b,c,e,f,g,h,k,l){var m,n,o,p,q,r,s;try{m=c?j(a,c):null;n=e?j(a,e):null;o=j(a,h);p=j(a,f);q=j(a,g);r=j(a,k);var t=a._get_curve_element_bytes(b.curvePtr);s=a._malloc(t);b=a._verifiable_unblind(b.voprfPtr,s,t,m,c?c.length:0,n,e?e.length:0,p,f.length,q,g.length,o,h.length,r,k.length,+l);if(b!==0)throw d("mapVoprfWasmError").mapVoprfWasmError(b);c=i(a,s,t);return{unblindedElement:c}}finally{[m,n,o,p,q,r,s].forEach(function(b){b!=null&&a._free(b)})}},clientFinalize:function(b,c,e){var f,g,h;try{f=j(a,c);g=j(a,e);var k=a._get_voprf_final_evaluation_bytes(b.voprfPtr);h=a._malloc(k);b=a._voprf_client_finalize(b.voprfPtr,h,k,f,c.length,g,e.length);if(b!==0)throw d("mapVoprfWasmError").mapVoprfWasmError(b);c=i(a,h,k);return{finalEvaluation:c}}finally{[f,g,h].forEach(function(b){b!=null&&a._free(b)})}},setup:function(b){var c,e;try{var f=a._get_curve_scalar_bytes(b.curvePtr),g=a._get_curve_element_bytes(b.curvePtr);c=a._malloc(f);e=a._malloc(g);b=a._voprf_setup(b.voprfPtr,e,g,c,f);if(b!==0)throw d("mapVoprfWasmError").mapVoprfWasmError(b);b=i(a,e,g);g=i(a,c,f);return{sk:b,pk:g}}finally{[c,e].forEach(function(b){b!=null&&a._free(b)})}},evaluate:function(b,c,e,f){var g,h,k,l,m;try{var n=a._get_curve_element_bytes(b.curvePtr);g=a._malloc(n);var o=f?a._get_curve_scalar_bytes(b.curvePtr):0;h=o>0?a._malloc(o):null;var p=f?a._get_curve_scalar_bytes(b.curvePtr):0;k=p>0?a._malloc(p):null;l=j(a,e);m=j(a,c);b=a._voprf_evaluate(b.voprfPtr,g,n,h,o,k,p,m,c.length,l,e.length,+f);if(b!==0)throw d("mapVoprfWasmError").mapVoprfWasmError(b);c=h!==null?i(a,h,o):null;e=k!==null?i(a,k,p):null;f=i(a,g,n);return{proofC:c,proofS:e,evaluatedElement:f}}finally{[g,h,k,l,m].forEach(function(b){b!=null&&a._free(b)})}},serverFinalize:function(b,c,e){var f,g,h;try{f=j(a,c);g=j(a,e);var k=a._get_voprf_final_evaluation_bytes(b.voprfPtr);h=a._malloc(k);b=a._voprf_server_finalize(b.voprfPtr,h,k,f,c.length,g,e.length);if(b!==0)throw d("mapVoprfWasmError").mapVoprfWasmError(b);c=i(a,h,k);return{finalEvaluation:c}}finally{[f,g,h].forEach(function(b){b!=null&&a._free(b)})}},wasmMemory:(b=a.wasmMemory)!=null?b:void 0})}).catch(function(a){throw c("err")("Failed to initialize wasm module, "+a)})})}function i(a,b,c){var d=new Uint8Array(c);for(var e=0;e<c;++e)d[e]=a.getValue(e+b,"i8");return d}function j(a,b){var c=b.length;c=a._malloc(c);a.writeArrayToMemory(b,c);return c}g.default=a}),98);
__d("LSVoprfWasm",["LSVoprfWasmBuilder","bx","ls_voprf_utils_v2"],(function(a,b,c,d,e,f,g){"use strict";var h=c("bx").getURL(c("bx")("30933"));a=function(){return h};b=c("LSVoprfWasmBuilder")(c("ls_voprf_utils_v2"));g.locateFile=a;g.LSVoprfWasm=b}),98);
__d("MWChatLogOpenChatTab",["MessengerWebEntryPointsUtil","MessengerWebEventsFalcoEvent","ODS"],(function(a,b,c,d,e,f,g){"use strict";var h,i={};function a(a,b,e){a===void 0&&(a=!1);(h||(h=d("ODS"))).bumpEntityKey(3185,"mwchat_tab","open_user");var f=d("MessengerWebEntryPointsUtil").cast(e);i[b]=f;return c("MessengerWebEventsFalcoEvent").log(function(){return{entry_point:f,event_name:"open_chat_tab",is_secured:a,other_user_fbid:a?null:b}})}function b(a,b,e){a===void 0&&(a=!1);(h||(h=d("ODS"))).bumpEntityKey(3185,"mwchat_tab","open_group");var f=d("MessengerWebEntryPointsUtil").cast(e);i[b]=f;return c("MessengerWebEventsFalcoEvent").log(function(){return{entry_point:f,event_name:"open_chat_tab",is_secured:a,thread_fbid:a?null:b}})}function e(a,b,e){a===void 0&&(a=!1);(h||(h=d("ODS"))).bumpEntityKey(3185,"mwchat_tab","open_page");var f=d("MessengerWebEntryPointsUtil").cast(e);i[b]=f;return c("MessengerWebEventsFalcoEvent").log(function(){return{entry_point:f,event_name:"open_chat_tab",is_secured:a,other_user_fbid:a?null:b}})}g.logOpenUserTab=a;g.logOpenGroupTab=b;g.logOpenPageTab=e}),98);
__d("MWChatOpenTabForGroupCallback",["I64","LSDatabaseSingleton","LSFactory","LSIntEnum","LSIssueMessagesRangeQueryStoredProcedure","LSMailboxMessagesRangeQueryDirection","LSMessagingThreadTypeUtil","Promise","ReQL","promiseDone","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function a(a){var e=(i||(i=d("I64"))).of_string(a);c("promiseDone")((k||(k=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(a){return a.runInTransaction(function(a){return d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.threads).getKeyRange(e)).then(function(f){if(f!=null)if(d("LSMessagingThreadTypeUtil").isArmadilloSecure(f.threadType)){c("recoverableViolation")("Preloading secure thread not implemented yet","messenger_web_entrypoints");return(h||(h=b("Promise"))).resolve()}else return d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.messages_ranges_v2__generated).getKeyRange(e)).then(function(b){if(b!=null&&b.minMessageId===b.maxMessageId)return c("LSIssueMessagesRangeQueryStoredProcedure")(c("LSFactory")(a),{direction:(j||(j=d("LSIntEnum"))).ofNumber(c("LSMailboxMessagesRangeQueryDirection").BEFORE),referenceTimestampMs:b.minTimestampMs,threadKey:e})});else return(h||(h=b("Promise"))).resolve()})},"readwrite",void 0,void 0,f.id+":27")}))}g.call=a}),98);
__d("MWChatTabOpenThreadCapabilitiesLoggingGated",["cr:10565"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:10565")}),98);
__d("MWGetOtherContactOrSelf",["I64","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b,c){a=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(c.tables.participants).getKeyRange(a));if(a.length===1){var e=a[0];return d("ReQL").firstAsync(d("ReQL").fromTableAscending(c.tables.contacts).getKeyRange(e.contactId))}if(a.length>2)return;e=a.find(function(a){return!(h||(h=d("I64"))).equal(a.contactId,b)});if(e!=null)return d("ReQL").firstAsync(d("ReQL").fromTableAscending(c.tables.contacts).getKeyRange(e.contactId))}g.getOtherContactOrSelf=a}),98);
__d("hasDefaultThreadOneToOneCapability",["FBLogger","LSContactBitOffset","MAWDefaultE2eeOneToOneEligibility","MWGetOtherContactOrSelf","ReQL"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,b){if(a==null)return!1;var e=await d("ReQL").firstExnAsync(d("ReQL").fromTableAscending(b.tables._user_info).map(function(a){return a.facebookUserId})),f=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.tables.contacts).getKeyRange(e));if(f==null){c("FBLogger")("messenger_search").warn("Error fetching viewer details");return!1}f=d("LSContactBitOffset").has(80,f);if(!f)return!1;f=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.tables.contacts).getKeyRange(a));a=await d("MWGetOtherContactOrSelf").getOtherContactOrSelf(a,e,b);e=a!=null?a:f;return d("MAWDefaultE2eeOneToOneEligibility").isContactDefaultE2eeOneToOneEligible({maybeContact:e})}g.default=a}),98);