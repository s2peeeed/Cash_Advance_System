;/*FB_PKG_DELIM*/

__d("MAWConvertMSGDataclassContentTypeToLSXmaContentType",["LSXmaContentType","MSGDataclassTypes.flow"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a==null)return null;switch(a){case d("MSGDataclassTypes.flow").XmsgXmaContentType.MsgReceiverFetch:return c("LSXmaContentType").MSG_RECEIVER_FETCH;case d("MSGDataclassTypes.flow").XmsgXmaContentType.FbFeedShare:return c("LSXmaContentType").FB_FEED_SHARE;case d("MSGDataclassTypes.flow").XmsgXmaContentType.FbStoryReply:return c("LSXmaContentType").FB_STORY_REPLY;case d("MSGDataclassTypes.flow").XmsgXmaContentType.FbStoryShare:return c("LSXmaContentType").FB_STORY_SHARE;case d("MSGDataclassTypes.flow").XmsgXmaContentType.FbStoryMention:return c("LSXmaContentType").FB_STORY_MENTION;case d("MSGDataclassTypes.flow").XmsgXmaContentType.FbFeedVideoShare:return c("LSXmaContentType").FB_FEED_VIDEO_SHARE;case d("MSGDataclassTypes.flow").XmsgXmaContentType.FbGamingCustomUpdate:return c("LSXmaContentType").FB_GAMING_CUSTOM_UPDATE;case d("MSGDataclassTypes.flow").XmsgXmaContentType.FbProducerStoryReply:return c("LSXmaContentType").FB_PRODUCER_STORY_REPLY;case d("MSGDataclassTypes.flow").XmsgXmaContentType.FbEvent:return c("LSXmaContentType").FB_EVENT;case d("MSGDataclassTypes.flow").XmsgXmaContentType.FbFeedPostPrivateReply:return c("LSXmaContentType").FB_FEED_POST_PRIVATE_REPLY;case d("MSGDataclassTypes.flow").XmsgXmaContentType.FbShort:return c("LSXmaContentType").FB_SHORT;default:return null}}g.convertMSGDataclassContentTypeToLSXmaContentType=a}),98);
__d("constructAttachmentFromXmaDataclass",["I64","MAWConvertMSGDataclassContentTypeToLSXmaContentType","MAWReceiverFetchQPLLogger","WAArmadilloXMA.pb"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a){var b;if(a==null)return{};var c=a==null?void 0:a.image;return{headerImageUrl:(b=c==null?void 0:c.url)!=null?b:void 0,headerImageUrlExpirationTimestampMs:(c==null?void 0:c.expiration_timestamp_ms)!=null?(h||(h=d("I64"))).of_string(c==null?void 0:c.expiration_timestamp_ms):void 0,headerImageUrlFallback:(b=c==null?void 0:c.url_fallback)!=null?b:void 0,headerImageUrlMimeType:(b=c==null?void 0:c.mime_type)!=null?b:void 0,headerSubtitleText:(c=a==null?void 0:a.subtitle)!=null?c:void 0,headerTitle:(b=a==null?void 0:a.title)!=null?b:void 0}},j=function(a){var b;return a==null?{}:{maxSubtitleNumOfLines:(a==null?void 0:a.max_subtitle_num_lines)!=null?(h||(h=d("I64"))).of_int32(a==null?void 0:a.max_subtitle_num_lines):void 0,maxTitleNumOfLines:(a==null?void 0:a.max_title_num_lines)!=null?(h||(h=d("I64"))).of_int32(a==null?void 0:a.max_title_num_lines):void 0,subtitleText:(b=a==null?void 0:a.subtitle)!=null?b:void 0,titleText:(b=a==null?void 0:a.title)!=null?b:void 0}},k=function(a){switch(a==null?void 0:a.__typename){case"XMSGXmaStandardGenericMultiMediaPreview":var b=a==null?void 0:a.medias;return b==null||b.length===0?null:b[0];case"XMSGXmaStandardGenericVideoPreview":return a==null?void 0:a.preview;default:return null}},l=function(a){a=k(a);return(a==null?void 0:a.url)!=null},m=function(a){var b;a=k(a);return{previewHeight:(a==null?void 0:a.height)!=null?(h||(h=d("I64"))).of_int32(a.height):void 0,previewUrl:(b=a==null?void 0:a.url)!=null?b:void 0,previewUrlExpirationTimestampMs:(a==null?void 0:a.expiration_timestamp_ms)!=null?(h||(h=d("I64"))).of_string(a.expiration_timestamp_ms):void 0,previewUrlFallback:(b=a==null?void 0:a.url_fallback)!=null?b:void 0,previewUrlMimeType:(b=a==null?void 0:a.mime_type)!=null?b:void 0,previewWidth:(a==null?void 0:a.width)!=null?(h||(h=d("I64"))).of_int32(a.width):void 0}};a=function(a,b){if((a==null?void 0:a.content)==null){d("MAWReceiverFetchQPLLogger").logFailure(b.messageId,"XMA_DATACLASS_IS_NULL");return null}var c=a.content;a=a.target_type;a=d("MAWConvertMSGDataclassContentTypeToLSXmaContentType").convertMSGDataclassContentTypeToLSXmaContentType(a);a=a?(h||(h=d("I64"))).of_int32(a):void 0;var e=c.custom_template_data;if(c.__typename==="XMSGXmaSingleContent"&&(e==null?void 0:e.__typename)==="XMSGXmaStandardGenericTemplateData"){var f;c=babelHelpers["extends"]({},i(e==null?void 0:e.header),{},j(e==null?void 0:e.body),{},m(e==null?void 0:e.preview),{gatingType:((f=c.gating)==null?void 0:f.type)!=null?(f=c.gating)==null?void 0:f.type:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NONE.toString(),hasMedia:l(e==null?void 0:e.preview),xmaContentType:a});return c}d("MAWReceiverFetchQPLLogger").logFailure(b.messageId,"TYPENAME_IS_NOT_XMA_SINGLE_CONTENT");return null};b=a;g["default"]=b}),98);
__d("LSHandleReceiverFetchXMADataclass.nop",["FBLogger","I64","MAWConvertMSGDataclassContentTypeToLSXmaContentType","MAWReceiverFetchQPLLogger","MSGDataclassTypes.flow","ReQL","constructAttachmentFromXmaDataclass","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;a=async function(a,b,e,f){b=await d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.messages.index("messageId")).getKeyRange(e));if(b==null){d("MAWReceiverFetchQPLLogger").logFailure(e,"EXISTING_MESSAGE_IS_NULL");return}var g=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.attachments).getKeyRange(b.threadKey,b.messageId));if(g==null){d("MAWReceiverFetchQPLLogger").logFailure(e,"EXISTING_ATTACHMENT_IS_NULL");return}var i;try{i=JSON.parse(f)}catch(a){d("MAWReceiverFetchQPLLogger").logFailure(e,"ERROR_PARSING_XMA_DATACLASS_CONTENT");c("FBLogger")("messenger_web_sharing").mustfix("Error parsing xma dataclass");return}if(c("gkx")("7835")){f=null;var j=g.defaultCtaId;if(j!=null){j=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.attachment_ctas).getKeyRange(j));j!=null&&(f={__typename:"XMSGXmaCta",action_url:j.actionUrl,cta_type:d("MSGDataclassTypes.flow").XmsgctaType.XmaWebUrl})}j=d("MAWConvertMSGDataclassContentTypeToLSXmaContentType").convertMSGDataclassContentTypeToLSXmaContentType(i.target_type);j=j!=null?(h||(h=d("I64"))).of_int32(j):void 0;f=babelHelpers.extends({},i,{content:babelHelpers.extends({},i.content,{default_cta:f})});await a.attachments.put(babelHelpers.extends({},g,{xmaContentType:j,xmaDataclass:JSON.stringify(f)}))}else{j=c("constructAttachmentFromXmaDataclass")(i,{attachmentFbid:g.attachmentFbid,attachmentIndex:(h||(h=d("I64"))).zero,messageId:e,threadKey:b.threadKey});await a.attachments.put(babelHelpers.extends({},g,{},j))}d("MAWReceiverFetchQPLLogger").logSuccess(e)};a.__nop_name__="LSHandleReceiverFetchXMADataclass";g.default=a}),98);