;/*FB_PKG_DELIM*/

__d("MWInboxMessageSearchJumpToResultQPL",["FBLogger","I64","MAWLoggerUtils","QPLUserFlow","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("justknobx")._("3865"),j=c("justknobx")._("3867"),k=null;function l(){k=null}function m(a,b,c){k={key:d("MAWLoggerUtils").getInstanceKey(),messageId:b,messageOtid:c,threadKey:a};return k.key}function a(a,b){if(k==null||(b==null?void 0:b.messageId)!==k.messageId&&(b==null?void 0:b.offlineThreadingId)!==k.messageOtid)return;b=k.key;c("QPLUserFlow").addPoint(c("qpl")._(25306290,"2811"),a,{instanceKey:b})}function b(a,b){if(!j||k==null||!(h||(h=d("I64"))).equal(b.threadKey,k.threadKey))return;try{var e=k.key;a=a.msgs;a=a.some(function(a){var b;return a.msgId===((b=k)==null?void 0:b.messageId)||a.externalId===((b=k)==null?void 0:b.messageOtid)});c("QPLUserFlow").addPoint(c("qpl")._(25306290,"2811"),a?"jumped_message_fetched":"message_fetch_checkpoint",{data:{string:{rangeMaxTimestamp:b.maxTimestampMs!=null?(h||(h=d("I64"))).to_string(b.maxTimestampMs):"null",rangeMinTimestamp:b.minTimestampMs!=null?(h||(h=d("I64"))).to_string(b.minTimestampMs):"null"}},instanceKey:e})}catch(a){c("FBLogger")("messenger_web_search").mustfix("Failed to check if jumped message are fetched: %s",a)}}function e(a){if(k==null||(a==null?void 0:a.messageId)!==k.messageId&&(a==null?void 0:a.offlineThreadingId)!==k.messageOtid)return;a=k.key;c("QPLUserFlow").endSuccess(c("qpl")._(25306290,"2811"),{instanceKey:a});l()}function f(a){if(k==null)return;var b=k.key;c("QPLUserFlow").endCancel(c("qpl")._(25306290,"2811"),{annotations:{string:{cancelReason:a}},instanceKey:b});l()}function n(a,b,d){a=m(a,b.messageId,b.offlineThreadingId);c("QPLUserFlow").start(c("qpl")._(25306290,"2811"),babelHelpers["extends"]({annotations:{string:{messageId:b==null?void 0:b.messageId,messageOtid:b==null?void 0:b.offlineThreadingId}},instanceKey:a,timeoutInMs:i},d))}g.addPointIfJumpedToMessage=a;g.checkIfJumpedMessageAreFetched=b;g.endSuccessIfJumpedToMessage=e;g.endCancelIfAny=f;g.start=n}),98);
__d("MAWFetchMessagesForMLv2",["DateConsts","MAWMessagesDirection","MAWMessagesPaginationUtils","MAWSecureLocalDBFetch","MWInboxMessageSearchJumpToResultQPL"],(function(a,b,c,d,e,f,g){"use strict";var h=10*d("DateConsts").MS_PER_SEC;async function a(a){var b=a.chatJid,e=a.direction,f=a.includeOriginalMsg,g=a.pageSize;a=a.range;var i=d("MAWMessagesDirection").getRangeMsgIdForDirection(e,a),j=await d("MAWMessagesPaginationUtils").getRangeExternalIdForDirection(e,a);b=await c("MAWSecureLocalDBFetch")({actionType:"user",chatJid:b,config:{admin:!0,editMsgHistory:!0,media:!0,polls:!0,reactions:!0,receiverFetch:!0,xma:!0},count:g,direction:d("MAWMessagesDirection").translateMwpDirectionToMawDirection(e),offsetMsg:{externalId:j,includeOriginalMsg:f,messageId:i},timestampMs:d("MAWMessagesDirection").getI64RangeTimestampForDirection(e,a)},{timeoutMs:h});b.success===!0&&(d("MAWMessagesPaginationUtils").populateExternalIdCache(b.value.msgs),d("MWInboxMessageSearchJumpToResultQPL").checkIfJumpedMessageAreFetched(b.value,a));return b}g.fetchMessagesFromMAW=a}),98);
__d("MAWFetchLocalMessagesAndMetadata",["MAWFetchMessagesForMLv2","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";async function a(a){var b=a.chatJid,c=a.direction,e=a.pageSize,f=a.range;a=a.sortFn;b=await d("MAWFetchMessagesForMLv2").fetchMessagesFromMAW({chatJid:b,direction:c,includeOriginalMsg:!0,pageSize:e+1,range:f});if(b.success===!1)return d("WAResultOrError").makeError(b.error);c=h(b.value.msgs).sort(a);return d("WAResultOrError").makeResult({localMsgsMetadata:c,mawFetchResult:b.value})}function h(a){return a.map(function(a){return{externalId:a.externalId,msgType:a.type_,sortOrderMs:a.sortOrderMs}})}g.default=a}),98);
__d("MAWFindMsgsWithMinAndMaxTimestamp",["MAWMessagesCompare","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a.length===0)return[null,null];if(c("qex")._("18"))return h(a);a=a.toSorted(function(a,b){return((a=a.sortOrderMs)!=null?a:0)-((a=b.sortOrderMs)!=null?a:0)});return[a[0],a[a.length-1]]}function b(a){a=a.filter(function(a){return a.sortOrderMs!=null});if(a.length===0)return[null,null];if(c("qex")._("18"))return h(a);var b=null,d=null;for(a of a){var e;if(a.sortOrderMs==null)continue;(((e=b)==null?void 0:e.sortOrderMs)==null||b.sortOrderMs<a.sortOrderMs)&&(b=a);(((e=d)==null?void 0:e.sortOrderMs)==null||d.sortOrderMs>a.sortOrderMs)&&(d=a)}return[d,b]}function h(a){if(a.length===0)return[null,null];var b=d("MAWMessagesCompare").getSortComparisonFunctionForDirection("asc");a=a.filter(function(a){return a.sortOrderMs!=null}).sort(b);return[a[0],a[a.length-1]]}g.findEBMsgsWithMinAndMaxTimestamp=a;g.findMsgsWithMinAndMaxTimestamp=b}),98);
__d("MAWMessagesRangesUtils",["I64","MAWFindMsgsWithMinAndMaxTimestamp","MAWMessagesDirection","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return{hasMoreAfter:!1,hasMoreBefore:!1,isLoadingAfter:!1,isLoadingBefore:!1,maxMessageId:"",maxTimestampMs:(h||(h=d("I64"))).max_int,minMessageId:"",minTimestampMs:h.min_int,threadKey:a}}function b(){return{maxExternalId:null,minExternalId:null}}function e(a){var b,e=a.direction,f=a.hasMoreMsgsInDeanon,g=a.mawFetchResult,j=a.range;a=a.rangeExternalIds;var k=[].concat(g.msgs).sort(function(a,b){return a.sortOrderMs-b.sortOrderMs}),l=k.length>0?k[0]:void 0;k=k.length>0?k[k.length-1]:void 0;var m=c("gkx")("8338");g=d("MAWMessagesDirection").switchOnMWPMessagesDirection(e,{asc:babelHelpers["extends"]({},j,{hasMoreAfter:g.hasMoreAfter||m&&f,isLoadingAfter:!1,maxMessageId:(b=k==null?void 0:k.msgId)!=null?b:j.maxMessageId,maxTimestampMs:(h||(h=d("I64"))).max(j.maxTimestampMs,(k==null?void 0:k.sortOrderMs)!=null?(h||(h=d("I64"))).of_float(k==null?void 0:k.sortOrderMs):j.maxTimestampMs)}),desc:babelHelpers["extends"]({},j,{hasMoreBefore:g.hasMoreBefore||m&&f,isLoadingBefore:!1,minMessageId:(b=l==null?void 0:l.msgId)!=null?b:j.minMessageId,minTimestampMs:h.min(j.minTimestampMs,(l==null?void 0:l.sortOrderMs)!=null?(h||(h=d("I64"))).of_float(l==null?void 0:l.sortOrderMs):j.minTimestampMs)})});m=i(e,l,k,a);return[g,m]}function f(a,b,c,e){var f,g=d("MAWFindMsgsWithMinAndMaxTimestamp").findMsgsWithMinAndMaxTimestamp(c.msgs),j=g[0];g=g[1];c=babelHelpers["extends"]({},a,{},d("MAWMessagesDirection").switchOnMWPMessagesDirection(e,{asc:{hasMoreAfter:c.hasMoreAfter,isLoadingAfter:!1,maxMessageId:(f=g==null?void 0:g.msgId)!=null?f:a.maxMessageId,maxTimestampMs:(h||(h=d("I64"))).max(a.maxTimestampMs,(g==null?void 0:g.sortOrderMs)!=null?(h||(h=d("I64"))).of_float(g==null?void 0:g.sortOrderMs):a.maxTimestampMs)},desc:{hasMoreBefore:c.hasMoreBefore,isLoadingBefore:!1,minMessageId:(f=j==null?void 0:j.msgId)!=null?f:a.minMessageId,minTimestampMs:h.min(a.minTimestampMs,(j==null?void 0:j.sortOrderMs)!=null?(h||(h=d("I64"))).of_float(j==null?void 0:j.sortOrderMs):a.minTimestampMs)}}));f=i(e,j,g,b);return[c,f]}function i(a,b,c,e){return babelHelpers["extends"]({},d("MAWMessagesDirection").switchOnMWPMessagesDirection(a,{asc:{maxExternalId:(a=c==null?void 0:c.externalId)!=null?a:e.maxExternalId,minExternalId:e.minExternalId},desc:{maxExternalId:e.maxExternalId,minExternalId:(c=b==null?void 0:b.externalId)!=null?c:e.minExternalId}}))}g.getRangeForFailure=a;g.getRangeExternalIdsForFailure=b;g.getNewMAWRange=e;g.mergeMoreMessagesResponseIntoRange=f;g.getNewMsgsRangesExternalIds=i}),98);
__d("MLv2LoggingUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){return"["+a.map(function(a){return"{"+a.externalId+", "+a.sortOrderMs+"}"}).join(", ")+"]"}f.getLogStrForMsgsMetadata=a}),66);
__d("EBDeanonRangeExtension",["FBLogger","I64","MAWFetchDeanonMetadataUsingCache","MAWFetchLocalMessagesAndMetadata","MAWMessagesCompare","MAWMessagesDirection","MAWMessagesRangesUtils","MAWMsgType","MLv2LoggingUtils","WATagsLogger","WATimeUtils","cr:17068","cr:19608","promiseDone","qex"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[","] MAW fetch failed: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Local external ids do not match de-anon. Local: [","], ToExistInLocal: [","]"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Local data exists but in the wrong order."]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Local data was sufficient, skipping EB restore, hasMoreMsgsInDeanon: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Not enough local metadata, hasMoreMsgsInDeanon: ",". Expected (","), got (",")."]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Deanon data is empty, check if de-anon API is enabled: bunnylol labyrinth <user_id>"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comparing deanon (size ",") and local (size ",") metadata"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[","] Filtered deanon data (to be compared with local) ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[","] Skip filtering given that it is a first page"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[","] Raw deanon data ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[","] Encountered unavailable or ciphertext message, EB restore is required"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[","] MAW fetch failed: ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[","] Deanon fetch failed: ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["[","] Fetching deanon and local data for page size ",""]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["[","] Range is not valid for EB deanon ",""]);w=function(){return a};return a}var x=d("WATagsLogger").TAGS(["EBDeanonRangeExtension"]);function y(a){return a.filter(function(a){return a.type_===d("MAWMsgType").MSG_TYPE.UNAVAILABLE||a.type_===d("MAWMsgType").MSG_TYPE.CIPHERTEXT}).length>0}function z(a,b){b=d("MAWMessagesDirection").getI64RangeTimestampForDirection(a,b);return d("MAWMessagesDirection").switchOnMWPMessagesDirection(a,{asc:!(h||(h=d("I64"))).equal(b,h.max_int),desc:!h.equal(b,h.min_int)})}async function a(a){var e=a.chatJid,f=a.db,g=a.direction,h=a.logger,i=a.pageSize,j=a.range;a=a.rangeExternalIds;if(!z(g,j)){x.LOG(w(),e,j.threadKey);return Promise.resolve(null)}var k=d("MAWMessagesCompare").getSortComparisonFunctionForDirection(g);x.LOG(v(),e,i);h==null?void 0:h.markQPLPoint("maw_fetch_for_deanon_optimisation_start");var l=d("MAWMessagesDirection").isFirstPageRange(j,g),m=await D({chatJid:e,direction:g,isFirstPage:l,logger:h,pageSize:i,range:j,rangeExternalIds:a,sortFn:k}),n;if(m.type==="skip"){h==null?void 0:h.addQPLAnnotations({bool:{skip_eb_opt:!0}});return m.value}else h==null?void 0:h.addQPLAnnotations({bool:{skip_eb_opt:!1},string:{skip_eb_opt_reason:m.reason}}),n=m.unappliedSuccessfulResult;m=m.value;f=await Promise.all([d("MAWFetchDeanonMetadataUsingCache").MAWFetchDeanonMetadataUsingCache({chatJid:e,db:f,direction:g,isFirstPage:l,logger:h,pageSize:i,range:j,sortFn:k}),m?Promise.resolve(m):c("MAWFetchLocalMessagesAndMetadata")({chatJid:e,direction:g,pageSize:i,range:j,sortFn:k})]);m=f[0];f=f[1];if(m.success===!1){x.WARN(u(),e,m.error);c("FBLogger")("messenger_web").info("EBMessageRangeDataSource: Deanon messages metadata fetch failed, try to fetch messages from EB");return Promise.resolve(null)}l&&b("cr:19608")&&c("promiseDone")(b("cr:19608").setLastEndOfThreadRestore(e,d("WATimeUtils").unixTime()),void 0,function(a){c("FBLogger")("messenger_web").catching(a).mustfix("Failed to read last first-page EB restore time")});if(f.success===!1){h==null?void 0:h.markQPLPoint("maw_fetch_for_deanon_optimisation_failed");x.WARN(t(),e,f.error);c("FBLogger")("messenger_web").warn("EBMessageRangeDataSource: MAW fetch fetch failed, try to fetch messages from EB");return Promise.resolve(null)}h==null?void 0:h.markQPLPoint("maw_fetch_for_deanon_optimisation_end");f=f.value;var o=f.localMsgsMetadata;f=f.mawFetchResult;if(y(f.msgs)){x.WARN(s(),e);return Promise.resolve(null)}x.LOG(r(),e,d("MLv2LoggingUtils").getLogStrForMsgsMetadata(m.value));l&&(x.LOG(q(),e),l=await B({deanonMsgsMetadata:m.value,direction:g,localMsgsMetadata:o,logger:h,mawFetchResult:f,pageSize:i,range:j,rangeExternalIds:a,sortFn:k}));f=A({mawFetchResult:f,sortedDeanonMsgsMetadata:m.value,sortedLocalMsgsMetadata:o});m=f.filteredDeanonMsgsMetadata;o=f.filteredLocalMsgsMetadata;f=f.filteredMawFetchResult;x.LOG(p(),e,d("MLv2LoggingUtils").getLogStrForMsgsMetadata(m));l=await B({deanonMsgsMetadata:m,direction:g,localMsgsMetadata:o,logger:h,mawFetchResult:f,pageSize:i,range:j,rangeExternalIds:a,sortFn:k});if(n)if(l.success){e=E(l.ranges,n);m=e.matchingExternalIds;g=e.matchingTimestamps;o=!(m&&g);h==null?void 0:h.addQPLAnnotations({bool:{heuristic_mismatch:o},string:o?{heuristic_mismatch_reason:"extIdRange: "+m.toString()+", tsRange: "+g.toString()}:{}})}else{h==null?void 0:h.addQPLAnnotations({bool:{heuristic_mismatch:!0},string:{heuristic_mismatch_reason:(f=l.reason)!=null?f:"unknown"}})}return l.success?l.ranges:null}function A(a){var b=a.mawFetchResult,c=a.sortedDeanonMsgsMetadata;a=a.sortedLocalMsgsMetadata;if(a.length===0)return{filteredDeanonMsgsMetadata:c,filteredLocalMsgsMetadata:a,filteredMawFetchResult:b};var d=a[0].externalId,e=a[0].sortOrderMs;a=a.slice(1);c=c.slice(c.findIndex(function(a){return a.externalId===d})+1);var f=b.msgs.filter(function(a){return!(a.externalId===d&&a.sortOrderMs===e)});return{filteredDeanonMsgsMetadata:c,filteredLocalMsgsMetadata:a,filteredMawFetchResult:babelHelpers.extends({},b,{msgs:f})}}async function B(a){var b=a.deanonMsgsMetadata,e=a.direction,f=a.localMsgsMetadata,g=a.logger,h=a.mawFetchResult,i=a.pageSize,j=a.range,k=a.rangeExternalIds;a=a.sortFn;g==null?void 0:g.markQPLPoint("maw_vs_eb_deanon_comparison_start");f=C(f,b,i,a);b=f.hasMoreMsgsInDeanon;i=f.isDataPresentLocally;a=f.rejectionReason;g==null?void 0:g.markQPLPoint("maw_vs_eb_deanon_comparison_end");g==null?void 0:g.addQPLAnnotations({bool:{is_data_restored_locally_when_extending_range:i}});c("FBLogger")("messenger_web").info("EBMessageRangeDataSource: Optimistic range extension using Deanon, isDataPresentLocally: %s",i.toString());return!i?Promise.resolve({reason:a,success:!1}):Promise.resolve({ranges:d("MAWMessagesRangesUtils").getNewMAWRange({direction:e,hasMoreMsgsInDeanon:b,mawFetchResult:h,range:j,rangeExternalIds:k}),success:!0})}function C(a,b,c,d){x.LOG(o(),b.length,a.length);if(b.length===0){x.WARN(n());return{hasMoreMsgsInDeanon:!1,isDataPresentLocally:!1,rejectionReason:"deanon_empty"}}var e=[].concat(b,a).reduce(function(a,b){a[b.externalId]=b;return a},{}),f=new Set([].concat(a.map(function(a){return a.externalId}),b.map(function(a){return a.externalId})));f=Array.from(f).map(function(a){return e[a]}).sort(d);d=f.slice(0,c);var g=new Set(f.slice(c).map(function(a){return a.externalId}));f=b.some(function(a){return g.has(a.externalId)});if(a.length<d.length){x.LOG(m(),f,d.length,a.length);return{hasMoreMsgsInDeanon:f,isDataPresentLocally:!1,rejectionReason:"local_too_small"}}c=d.every(function(b,c){return b.externalId===a[c].externalId});if(c){x.LOG(l(),f);return{hasMoreMsgsInDeanon:f,isDataPresentLocally:!0}}else{var h=new Set(a.map(function(a){return a.externalId}));if(d.every(function(a,b){return h.has(a.externalId)})){x.WARN(k());return{hasMoreMsgsInDeanon:f,isDataPresentLocally:!1,rejectionReason:"local_wrong_order"}}x.LOG(j(),a.map(function(a){return a.externalId}).join(", "),d.map(function(a){return a.externalId}).join(", "));return{hasMoreMsgsInDeanon:f,isDataPresentLocally:!1,rejectionReason:"local_wrong_ids"}}}async function D(a){var e,f,g,j,k,l=a.chatJid,m=a.direction,n=a.isFirstPage,o=a.logger,p=a.pageSize,q=a.range,r=a.rangeExternalIds;a=a.sortFn;e=(e=c("qex")._("4264"))!=null?e:!1;f=(f=c("qex")._("3886"))!=null?f:0;g=(g=c("qex")._("3540"))!=null?g:0;j=(j=c("qex")._("3991"))!=null?j:!1;k=(k=c("qex")._("4567"))!=null?k:!1;if(b("cr:17068")==null||!(n||e))return{reason:"disabled",type:"fetch"};e=await b("cr:17068").getDeviceAge();var s=e.device,t=e.oqMaybeOverflowedThisSession;e=e.oqPotentialOverflowTime;if(s==null)return{reason:"new_device",type:"fetch"};var u=s.deviceRegTime;s=s.lastActivityTime;if(t||e!=null&&e>u)return{reason:"giant_oq",type:"fetch"};t=d("WATimeUtils").unixTime();if(t-s>g)return{reason:"device_too_old",type:"fetch"};if(t-u<f)return{reason:"device_too_young",type:"fetch"};o==null?void 0:o.markQPLPoint("maw_fetch_for_deanon_skip_optimisation_start");e=await c("MAWFetchLocalMessagesAndMetadata")({chatJid:l,direction:m,pageSize:p,range:q,sortFn:a});if(e.success===!1){o==null?void 0:o.markQPLPoint("maw_fetch_for_deanon_skip_optimisation_failed");x.WARN(i(),l,e.error);c("FBLogger")("messenger_web").warn("EBMessageRangeDataSource: MAW fetch fetch failed, try to fetch messages from EB");return{reason:"maw_fetch_failed",type:"fetch"}}o==null?void 0:o.markQPLPoint("maw_fetch_for_deanon_skip_optimisation_end");var v=(h||(h=d("I64"))).of_float(u);s=e.value.localMsgsMetadata.filter(function(a){var b=a.isOptimistic;a=a.sortOrderMs;return b!==!0&&(h||(h=d("I64"))).ge((h||(h=d("I64"))).of_float(a/1e3),v)});g=!1;if(b("cr:19608")!=null&&n){a=(t=await b("cr:19608").getLastEndOfThreadRestore(l))!=null?t:0;a>u&&a-u>=f&&(g=!0)}o=n?p:p+1;if((s.length<o||!j)&&!g)return{reason:"heuristics_failed",type:"fetch",value:e};l=d("MAWMessagesRangesUtils").getNewMAWRange({direction:m,hasMoreMsgsInDeanon:!0,mawFetchResult:e.value.mawFetchResult,range:q,rangeExternalIds:r});return k?{reason:"success_but_skipping_application",type:"fetch",unappliedSuccessfulResult:l,value:e}:{type:"skip",value:l}}function E(a,b){a=a[0];b=b[0];var c=(h||(h=d("I64"))).equal(a.minTimestampMs,b.minTimestampMs)&&(h||(h=d("I64"))).equal(a.maxTimestampMs,b.maxTimestampMs);a=a.minMessageId===b.minMessageId&&a.maxMessageId===b.maxMessageId;return{matchingExternalIds:a,matchingTimestamps:c}}g.getRangeFromLocalDataIfConsistent=a;g.excludeOffsetMsg=A;g.isDeanonDataPresentLocally=C}),98);
__d("useLSComputedThreadName",["CometTextWithEntities.react","react","react-compiler-runtime","useLSGetThreadTitle.react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a,b){var e=d("react-compiler-runtime").c(12);a=c("useLSGetThreadTitle.react")(a);var f,g;e[0]!==a?(g=a.threadTitle,f=babelHelpers.objectWithoutPropertiesLoose(a,["threadTitle"]),e[0]=a,e[1]=f,e[2]=g):(f=e[1],g=e[2]);if(g==null){e[3]===Symbol["for"]("react.memo_cache_sentinel")?(a=i.jsx(c("CometTextWithEntities.react"),{text:""}),e[3]=a):a=e[3];e[4]!==f?(a=babelHelpers["extends"]({threadNameElement:a},f),e[4]=f,e[5]=a):a=e[5];return a}e[6]!==g||e[7]!==b?(a=i.jsx(c("CometTextWithEntities.react"),{text:g,transforms:b}),e[6]=g,e[7]=b,e[8]=a):a=e[8];e[9]!==f||e[10]!==a?(g=babelHelpers["extends"]({threadNameElement:a},f),e[9]=f,e[10]=a,e[11]=g):g=e[11];return g}g["default"]=a}),98);
__d("LSThreadTitle.react",["CometTextWithEntities.react","MWChatTextTransform","mwCMIsAnyCMThread","react","react-compiler-runtime","recoverableViolation","useLSComputedThreadName"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function j(a){var b=a.thread;a=a.transforms;return c("useLSComputedThreadName")(b,a).threadNameElement}function a(a){var b=d("react-compiler-runtime").c(7),e=a.thread;a=a.transforms;a=a===void 0?d("MWChatTextTransform").textTransforms:a;var f=e.threadName;if(f!=null){var g;b[0]!==f||b[1]!==a?(g=i.jsx(c("CometTextWithEntities.react"),{text:f,transforms:a}),b[0]=f,b[1]=a,b[2]=g):g=b[2];return g}if(c("mwCMIsAnyCMThread")(e.threadType)){c("recoverableViolation")("community message should not use computed thread title","messenger_comet");b[3]===Symbol["for"]("react.memo_cache_sentinel")?(f=i.jsx(c("CometTextWithEntities.react"),{text:""}),b[3]=f):f=b[3];return f}b[4]!==e||b[5]!==a?(g=i.jsx(j,{thread:e,transforms:a}),b[4]=e,b[5]=a,b[6]=g):g=b[6];return g}g["default"]=a}),98);
__d("MAWFetchMessagesFromEBForMLv2",["EbFetchTimeoutMsForMLv2","FBLogger","I64","MAWEBFetch","MAWEBMsgsWithSameSortOrderFix","MAWMessagesDirection","MAWMessagesPaginationUtils","MAWTraceUtils","MWEncryptedBackUpEBNotEnabledError","WAResultOrError","WATagsLogger","WATimeUtils","cr:19608","promiseDone","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["EBMessageRangeDataSource: Failed to fetch messages from EB. Message: "," TraceId: "," Request: ",""]);i=function(){return a};return a}var j="timeout";async function a(a){var e=a.chatJid,f=a.db,g=a.direction,l=a.logger,m=a.pageSize;a=a.range;l==null?void 0:l.markQPLPoint("wait_eb_fetch_start");var n=d("MAWMessagesDirection").getI64RangeTimestampForDirection(g,a),o=e+":"+(h||(h=d("I64"))).to_string(n)+":"+g+":"+m,p=await d("MAWMessagesPaginationUtils").getRangeExternalIdForDirection(g,a),q=d("MAWEBMsgsWithSameSortOrderFix").overFetchEBMsgsIfNeeded(m,p),r=d("MAWMessagesDirection").translateMwpDirectionToMawDirection(g),s=d("MAWMessagesDirection").isFirstPageRange(a,g),t=d("MAWTraceUtils").createTraceId();q=await Promise.race([c("MAWEBFetch")({chatJid:e,count:q,db:f,direction:r,timestampMs:n,traceId:t}),new Promise(function(a){return window.setTimeout(function(){return a(d("WAResultOrError").makeError(j))},c("EbFetchTimeoutMsForMLv2")())})]);if(q.success===!1){l==null?void 0:l.markQPLPoint("eb_fetch_response_fail");l==null?void 0:l.addQPLAnnotations({string:{eb_failure_reason:q.error,eb_restore_status:q.error}});q.error!==j&&q.error!==d("MWEncryptedBackUpEBNotEnabledError").EB_NOT_ENABLED&&d("WATagsLogger").TAGS(["maw_message_core","EBMessageRangeDataSource",t]).ERROR(i(),q.error,t,o);return q}s&&b("cr:19608")&&c("promiseDone")(b("cr:19608").setLastEndOfThreadRestore(e,d("WATimeUtils").unixTime()),void 0,function(a){c("FBLogger")("messenger_web").catching(a).mustfix("Failed to read last first-page EB restore time")});l==null?void 0:l.addQPLAnnotations({string:{eb_restore_status:"success",eb_restore_type:(f=q.value)==null?void 0:f.restoreType}});n=d("MAWEBMsgsWithSameSortOrderFix").fixEBFetchResultPagination({direction:r,ebFetchResult:q.value,msgCount:m,referenceExternalId:p});t=k({direction:g,fetchResult:n,range:a});l==null?void 0:l.markQPLPoint("wait_eb_fetch_end");return d("WAResultOrError").makeResult({raw:n,recovered:t})}function k(a){var b=a.direction,e=a.fetchResult,f=a.range;a=b==="asc"?e.messages.filter(function(a){return a.sortOrderMs!=null&&(h||(h=d("I64"))).ge((h||(h=d("I64"))).of_float(a.sortOrderMs),f.maxTimestampMs)}):e.messages.filter(function(a){return a.sortOrderMs!=null&&(h||(h=d("I64"))).le((h||(h=d("I64"))).of_float(a.sortOrderMs),f.minTimestampMs)});var g=babelHelpers.extends({},e,{messages:a});a.length!==e.messages.length&&c("recoverableViolation")("EBMessageRangeDataSource: EB fetch API returned invalid messages outside requested timerange","messenger_web_product");a.length===0&&(b==="asc"&&e.hasMoreAfter&&(g.hasMoreAfter=!1,c("recoverableViolation")("EBMessageRangeDataSource: Unexpected null messages after","messenger_web_product")),b==="desc"&&e.hasMoreBefore&&(g.hasMoreBefore=!1,c("recoverableViolation")("EBMessageRangeDataSource: Unexpected null messages before","messenger_web_product")));return g}g.default=a}),98);
__d("MAWEBRestoreExtensionStep",["FBLogger","I64","MAWFetchMessagesForMLv2","MAWFetchMessagesFromEBForMLv2","MAWFindMsgsWithMinAndMaxTimestamp","MAWMessagesDirection","MAWMessagesRangesUtils","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h,i=async function(a){var b=a.chatJid,e=a.count,f=a.db,g=a.direction,i=a.logger,j=a.oldRange,k=a.oldRangeExternalIds;a=a.prevResponse;a=c("nullthrows")(a);f=await c("MAWFetchMessagesFromEBForMLv2")({chatJid:b,db:f,direction:g,logger:i,pageSize:e,range:j});if(f.success===!1)return{extension:a,status:"complete"};i=await d("MAWFetchMessagesForMLv2").fetchMessagesFromMAW({chatJid:b,direction:g,includeOriginalMsg:!1,pageSize:e,range:j});if(i.success===!1){c("FBLogger")("messenger_web").mustfix("Failed to fetch messages from MAW after successful EB restore");return{extension:a,status:"complete"}}b=i.value;var l=f.value.recovered;e=l.messages;a=e.map(function(a){return a.sortOrderMs}).filter(Boolean);i=[Math.min.apply(Math,a),Math.max.apply(Math,a)];f=i[0];a=i[1];i=d("MAWMessagesDirection").getI64RangeTimestampForDirection(g,j);f=g==="desc"?[(h||(h=d("I64"))).of_float(f),i]:[i,(h||(h=d("I64"))).of_float(a)];var m=f[0],n=f[1];i=b.msgs.filter(function(a){return(h||(h=d("I64"))).ge((h||(h=d("I64"))).of_float(a.sortOrderMs),m)&&(h||(h=d("I64"))).le((h||(h=d("I64"))).of_float(a.sortOrderMs),n)});a=babelHelpers.extends({},b,{hasMoreAfter:b.hasMoreAfter||l.hasMoreAfter,hasMoreBefore:b.hasMoreBefore||l.hasMoreBefore,msgs:i});f=i.length===0||l.isEndOfCurrentFormat;if(!f)return{extension:a,status:"complete"};var o,p;if(i.length===0){c("FBLogger")("messenger_web").mustfix("EBMessageRangeDataSource: No local messages found within EB response range for protobuf. Filtered EB payload size: %s, original EB payload size: %s, original EB hasMoreBefore: %s, original EB hasMoreAfter: %s",e.length,l.messages.length,l.hasMoreBefore,l.hasMoreAfter);b=d("MAWFindMsgsWithMinAndMaxTimestamp").findEBMsgsWithMinAndMaxTimestamp(e);o=b[0];p=b[1]}else{f=d("MAWFindMsgsWithMinAndMaxTimestamp").findMsgsWithMinAndMaxTimestamp(i);o=f[0];p=f[1]}e=babelHelpers.extends({},j,{},function(){switch(g){case"asc":var a,b;a=(a=(a=p)==null?void 0:a.msgId)!=null?a:j.maxMessageId;b=(h||(h=d("I64"))).max(j.maxTimestampMs,((b=p)==null?void 0:b.sortOrderMs)!=null?(h||(h=d("I64"))).of_float((b=p)==null?void 0:b.sortOrderMs):j.maxTimestampMs);if(l.hasMoreAfter===!0){var e=!1;(h||(h=d("I64"))).equal(j.maxTimestampMs,b)&&j.maxMessageId===a?(c("FBLogger")("messenger_web").mustfix("EBMessageRangeDataSource: stuck in the same max timestamp: %s",(h||(h=d("I64"))).to_string(b)),e=!0,b=h.add(b,h.of_int32(1))):l.isEndOfCurrentFormat===!0&&(e=!0);e&&(b=(h||(h=d("I64"))).equal(b,(h||(h=d("I64"))).max_int)?b:(h||(h=d("I64"))).add(b,(h||(h=d("I64"))).of_int32(1)))}return{hasMoreAfter:l.hasMoreAfter,isLoadingAfter:!1,maxMessageId:a,maxTimestampMs:b};case"desc":b=(a=(e=o)==null?void 0:e.msgId)!=null?a:j.minMessageId;e=(h||(h=d("I64"))).min(j.minTimestampMs,((e=o)==null?void 0:e.sortOrderMs)!=null?(h||(h=d("I64"))).of_float((a=o)==null?void 0:a.sortOrderMs):j.minTimestampMs);if(l.hasMoreBefore===!0){a=!1;(h||(h=d("I64"))).equal(j.minTimestampMs,e)&&j.minMessageId===b?(c("FBLogger")("messenger_web").mustfix("EBMessageRangeDataSource: stuck in the same min timestamp: %s",(h||(h=d("I64"))).to_string(e)),a=!0):l.isEndOfCurrentFormat===!0&&(a=!0);a&&(e=(h||(h=d("I64"))).equal(e,(h||(h=d("I64"))).min_int)?e:(h||(h=d("I64"))).sub(e,(h||(h=d("I64"))).of_int32(1)))}return{hasMoreBefore:l.hasMoreBefore,isLoadingBefore:!1,minMessageId:b,minTimestampMs:e}}}());b=d("MAWMessagesRangesUtils").getNewMsgsRangesExternalIds(g,o,p,k);return{extension:a,status:"complete_with_range_override",updatedRange:e,updatedRangeExternalIds:b}};function a(a){var b=a.onEBFailure,d=a.skipEb;return async function(a){if(d===!0)return{extension:c("nullthrows")(a.prevResponse),status:"complete"};a=await i(a);if(a.status==="eb_failed"){b();return{extension:a.extension,status:"complete"}}return a}}g.createEBRestoreExtensionStep=a}),98);
__d("MAWLocalAndDeanonExtensionStep",["EBDeanonRangeExtension","MAWFetchMessagesForMLv2","MAWMpsGating","MAWTimedBridge","WATagsLogger","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWMessageRangeDataSource: Failed to fetch messages from worker due to ",". Error: ",""]);h=function(){return a};return a}a=function(a){return async function(b){var e=b.chatJid,f=b.count,g=b.db,i=b.direction;b.dispatch;var j=b.logger,k=b.oldRange;b=b.oldRangeExternalIds;g=await Promise.all([a&&!d("MAWMpsGating").isMpsM3Only()?d("EBDeanonRangeExtension").getRangeFromLocalDataIfConsistent({chatJid:e,db:g,direction:i,logger:j,pageSize:f,range:k,rangeExternalIds:b,shouldInsertToLSDB:!1}):null,d("MAWFetchMessagesForMLv2").fetchMessagesFromMAW({chatJid:e,direction:i,includeOriginalMsg:!0,pageSize:f,range:k})]);b=g[0];e=g[1];if(e.success===!1){i=e.payload;f=i==null?"unknown":"["+i.name+"]: "+i.message;d("WATagsLogger").TAGS(["maw_message_core","MAWMessageRangeDataSource"]).ERROR(h(),e.error,f);if(e.payload instanceof d("MAWTimedBridge").MAWBridgeTimeoutError)return{status:"try_again"};throw(k=e.payload)!=null?k:c("err")("Failed to fetch messages from worker")}if(b!=null){a&&(j==null?void 0:j.addQPLAnnotations({string:{eb_restore_status:"skipped"}}));d("MAWMpsGating").isMpsM3Only()&&(j==null?void 0:j.addQPLAnnotations({string:{mps_status:"m3"}}));return{extension:e.value,status:"complete"}}return{extension:e.value,status:"continue"}}};b=a;g.default=b}),98);
__d("ReplayLastSubjectWithMapper",["relay-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h=Object.freeze({});a=function(){function a(a,b){var c=this;a===void 0&&(a=h);this.$1=!1;this.$5=new Set();this.$3=a;this.$6=b;this.$4=d("relay-runtime").Observable.create(function(a){if(c.$1){c.$2!=null?a.error(c.$2):a.complete();return}c.$5.add(a);c.$3!==h&&a.next(c.$6(c.$3));return function(){c.$5["delete"](a)}})}var b=a.prototype;b.next=function(a){if(this.$1)return;if(this.$3===a)return;this.$3=a;this.$5.forEach(function(b){return b.next(a)})};b.error=function(a){if(this.$1)return;this.$1=!0;this.$2=a;this.$5.forEach(function(b){return b.error(a)})};b.complete=function(){if(this.$1)return;this.$1=!0;this.$5.forEach(function(a){return a.complete()})};b.subscribe=function(a){return this.$4.subscribe(a)};return a}();g.ReplayLastSubjectWithMapper=a}),98);
__d("MAWMessageRangeDataExternalObservables",["ReplayLastSubjectWithMapper","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$1=[]}var b=a.prototype;b.getOrCreateExternalObservableForRange=function(a,b){var c=this.$1.find(function(b){var c=b[0];b[1];return a===c});if(c!=null)return c[1];c=new(d("ReplayLastSubjectWithMapper").ReplayLastSubjectWithMapper)({range:a.value,rangeExternalIds:b},function(a){var b=a.range;a=a.rangeExternalIds;return{range:b,rangeExternalIds:a}});this.$1.push([a,c]);return c};b.updateExternalObservableWithRange=function(a,b){var d=c("nullthrows")(this.$1.find(function(b){b[0];b=b[1];return b===a}));d[0]!==b&&(d[0]=b)};return a}();g.MAWMessageRangeDataExternalObservables=a}),98);
__d("MAWMpsM3RangeExtension",["MAWFetchMessagesForMLv2","MAWTimedBridge","WATagsLogger","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWMpsM3RangeExtension: Failed to fetch messages from worker due to ",". Error: ",""]);h=function(){return a};return a}a=async function(a){var b=a.chatJid,e=a.count,f=a.direction,g=a.logger;a=a.oldRange;b=await d("MAWFetchMessagesForMLv2").fetchMessagesFromMAW({chatJid:b,direction:f,includeOriginalMsg:!0,pageSize:e,range:a});if(b.success===!1){f=b.payload;e=f==null?"unknown":"["+f.name+"]: "+f.message;d("WATagsLogger").TAGS(["maw_message_core","MAWMessageRangeDataSource"]).ERROR(h(),b.error,e);if(b.payload instanceof d("MAWTimedBridge").MAWBridgeTimeoutError)return{status:"try_again"};throw(a=b.payload)!=null?a:c("err")("Failed to fetch messages from worker")}g==null?void 0:g.addQPLAnnotations({string:{mps_status:"m3"}});return{extension:b.value,status:"continue"}};g.mpsM3RangeExtension=a}),98);
__d("MAWWaitForACTThreadReadyForMLv2",["MAWMiActGetThreadLifecycleState","MAWMiActOnActThreadReady"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,b,c,e){var f=await d("MAWMiActGetThreadLifecycleState").getThreadLifecycleStateByThreadKey(a,b,c);e==null?void 0:e.addQPLAnnotations({string:{mi_act_thread_state_type:f.type}});e=await d("MAWMiActOnActThreadReady").waitForACTThreadReady(a,b,c);return e}g.waitForACTThreadReadyForMLv2=a}),98);
__d("MLV2RangeExtensionLogger",["I64","MAWQPLLogger","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){i==null&&(i=c("MAWQPLLogger")(c("qpl")._(1056843758,"1768")));return i}var k=new Map();function l(a,b){return(h||(h=d("I64"))).to_string(a)+b}function a(a,b,c,e){var f=l(a,b),g=k.get(f);g!=null&&g.markQPLCancel("restart_logger");var i=j().markQPLStart(),m=new Set();g={addQPLAnnotations:function(a){j().addQPLAnnotations(i,a)},annotateMessageRangesDataSource:function(a){m.add(a),j().addQPLAnnotations(i,{string_array:{message_ranges_source:Array.from(m.keys())}})},getInstanceKey:function(){return i},markQPLCancel:function(a){j().addQPLAnnotations(i,{string:{cancel_reason:a}}),j().markQPLCancel(i),k["delete"](f)},markQPLFailure:function(a){j().markQPLFailure(i,a),k["delete"](f)},markQPLFailureWithMsg:function(a){j().markQPLFailureWithMsg(i,a),k["delete"](f)},markQPLPoint:function(a){j().markQPLPoint(i,a)},markQPLSuccess:function(){j().markQPLSuccess(i),k["delete"](f)}};g.addQPLAnnotations({bool:{is_initial_range:(h||(h=d("I64"))).equal(c.minTimestampMs,(h||(h=d("I64"))).max_int)&&(h||(h=d("I64"))).equal(c.maxTimestampMs,(h||(h=d("I64"))).max_int)},"int":{page_size:e},string:{direction:b,start_range:JSON.stringify(babelHelpers["extends"]({},c,{maxTimestampMs:c.maxTimestampMs==null?null:(h||(h=d("I64"))).to_string(c.maxTimestampMs),minTimestampMs:c.minTimestampMs==null?null:(h||(h=d("I64"))).to_string(c.minTimestampMs)})),thread_id:(h||(h=d("I64"))).to_string(a)}});k.set(f,g);return g}function b(a,b){a=l(a,b);return k.get(a)}g.startRangeExtensionLoggerForThread=a;g.getRangeExtensionLoggerForThread=b}),98);
__d("MessageRangeSet",["I64","ReplayLastSubject","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c;c=b.call(this,a)||this;c.value=a;return c}var c=a.prototype;c.next=function(a){this.value=a,b.prototype.next.call(this,a)};return a}(d("ReplayLastSubject").ReplayLastSubject),j=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c;c=b.call(this,a)||this;for(var d=arguments.length,e=new Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];e.forEach(function(a){c.subscribe({complete:function(){return a.complete()},error:function(b){return a.error(b)},next:function(b){return a.next(b)}})});c.next(a);return c}return a}(i);a=function(){function a(){this.$1=new Set()}var b=a.prototype;b.$2=function(a){for(var b of this.$1){var c=b.value;if((h||(h=d("I64"))).le(c.minTimestampMs,a)&&((h||(h=d("I64"))).ge(c.maxTimestampMs,a)||!c.hasMoreAfter))return b}return null};b.getRangeForTimestamp=function(a){return this.$2(a)};b.upsertRange=function(a){var b=Array.from(this.$1.values()).filter(function(b){return l(b.value,a)});if(b.length===0){var c=new i(a);this.$1.add(c);return c}c=k.apply(void 0,b.map(function(a){return a.value}).concat([a]));if(b.length===1){var d=b[0];d.next(c);return d}for(d of b)this.$1["delete"](d);d=babelHelpers.construct(j,[c].concat(b));this.$1.add(d);return d};return a}();function k(){for(var a=arguments.length,b=new Array(a),e=0;e<a;e++)b[e]=arguments[e];if(b.length===0)throw c("err")("Cannot merge 0 ranges");var f=b[0].threadKey,g=b[0].minTimestampMs,i=b[0].hasMoreAfter,j=b[0].hasMoreBefore,k=b[0].maxMessageId,l=b[0].minMessageId,m=b[0].maxTimestampMs;for(var n=1;n<b.length;n++){var o=b[n];(h||(h=d("I64"))).le(o.minTimestampMs,g)&&((h||(h=d("I64"))).equal(o.minTimestampMs,g)?j=j&&o.hasMoreBefore:j=o.hasMoreBefore,g=o.minTimestampMs,l=o.minMessageId);(h||(h=d("I64"))).ge(o.maxTimestampMs,m)&&((h||(h=d("I64"))).equal(o.maxTimestampMs,m)?i=i&&o.hasMoreAfter:i=o.hasMoreAfter,m=o.maxTimestampMs,k=o.maxMessageId)}return{hasMoreAfter:i,hasMoreBefore:j,isLoadingAfter:!1,isLoadingBefore:!1,maxMessageId:k,maxTimestampMs:m,minMessageId:l,minTimestampMs:g,threadKey:f}}function l(a,b){var c=(h||(h=d("I64"))).le(b.minTimestampMs,a.minTimestampMs),e=c?b:a;c=c?a:b;return m(e,c.minTimestampMs)?!0:!1}function m(a,b){return(h||(h=d("I64"))).ge(b,a.minTimestampMs)&&(h||(h=d("I64"))).le(b,a.maxTimestampMs)}g.MessageRangeSet=a;g.Subject=i}),98);
__d("MpsMessageToLoadResponse",["MpsMessageToBridge"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=[],c=[],e=[],f=[],g=[],h=[];for(a of a){var i;i=(i=d("MpsMessageToBridge").mpsFullMessagetoBridge(a))!=null?i:{};var j=i.supplementals;i=i.topLevel;j==null?void 0:j.forEach(function(a){a.kind==="bridgeEditHistoryMsg"?b.push(a.value):a.kind==="bridgeReactionAction"?c.push(a.value):a.kind==="bridgeMsgsStartCountdown"?f.push.apply(f,a.value.msgs):a.kind==="bridgeMedia"?h.push(a.value):a.kind==="bridgeReceiverFetchInfo"&&g.push(a.value)});(i==null?void 0:i.kind)==="bridgeMsg"&&e.push(i.value)}return{editMsgHistory:b,expiringCountdown:f,medias:h,msgs:e,polls:[],reactions:c,receiverFetchInfoPayloads:g,xmas:[]}}g.messageToLoadMsgsResponse=a}),98);
__d("MpsLoadMessagesStep",["I64","MAWAckLevel","MAWLocalizationType","MAWMessagesDirection","MpsMessageToLoadResponse","MpsOverBridge","MpsToBridgeMessageId","MpsTypes","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c){var e=a+"CUTOVER",f=d("MpsTypes").toMessageId(e),g=d("MpsTypes").toThreadId(e);a={ack:d("MAWAckLevel").ACK.received,adminContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE,adminVersion:1,chatJid:a,externalId:e,forwardingScore:0,isAdminMessage:!0,isAuthorMe:!1,isForwarded:!1,msgId:d("MpsToBridgeMessageId").mpsToBridgeMsgId(g,f),sender:"",sortOrderMs:0,ts:d("WATimeUtils").castToUnixTime(0),type_:"Admin"};b.msgs=[a].concat(b.msgs);c.endCursor=[0,f]}async function a(a){var b=a.chatJid,e=a.count,f=a.direction,g=a.logger,j=a.oldRange;a=a.oldRangeExternalIds;g==null?void 0:g.addQPLAnnotations({bool:{use_mps:!0}});var k=[d("MpsTypes").toTimestamp((h||(h=d("I64"))).to_float(d("MAWMessagesDirection").getI64RangeTimestampForDirection(f,j))),d("MpsTypes").toMessageId(d("MAWMessagesDirection").getRangeMsgIdForDirection(f,j))];g==null?void 0:g.markQPLPoint("mps_load_messages_start");k=await d("MpsOverBridge").mps().loadMessages({debug:{purpose:"load-more"},direction:f,from:k,numMessages:e,threadId:d("MpsTypes").toThreadId(b)});if(k.success===!1){g==null?void 0:g.markQPLPoint("mps_load_messages_failure");throw c("err")("Failed to fetch messages from MPS")}else{e=d("MAWMessagesDirection").switchOnMWPMessagesDirection(f,{asc:k.value.cursorInfo.hasNext,desc:k.value.cursorInfo.hasPrevious});var l=d("MAWMessagesDirection").switchOnMWPMessagesDirection(f,{asc:k.value.cursorInfo.hasPrevious,desc:k.value.cursorInfo.hasNext}),m=babelHelpers.extends({},d("MpsMessageToLoadResponse").messageToLoadMsgsResponse(k.value.messages),{hasMoreAfter:e,hasMoreBefore:l});l===!1&&f==="desc"&&i(b,m,k.value.cursorInfo);b=j;var n=a;k=k.value.cursorInfo.endCursor;k!=null?(b=babelHelpers.extends({},j,{},d("MAWMessagesDirection").switchOnMWPMessagesDirection(f,{asc:{hasMoreAfter:e,isLoadingAfter:!1,maxMessageId:k[1],maxTimestampMs:(h||(h=d("I64"))).of_float(k[0])},desc:{hasMoreBefore:l,isLoadingBefore:!1,minMessageId:k[1],minTimestampMs:h.of_float(k[0])}})),n=d("MAWMessagesDirection").switchOnMWPMessagesDirection(f,{asc:{maxExternalId:k[1],minExternalId:a.minExternalId},desc:{maxExternalId:a.maxExternalId,minExternalId:k[1]}})):b=babelHelpers.extends({},j,{},d("MAWMessagesDirection").switchOnMWPMessagesDirection(f,{asc:{hasMoreAfter:e,isLoadingAfter:!1},desc:{hasMoreBefore:l,isLoadingBefore:!1}}));g==null?void 0:g.markQPLPoint("mps_load_messages_end");return{extension:m,status:"complete_with_range_override",updatedRange:b,updatedRangeExternalIds:n}}}g.addCutoverAdminMessage=i;g.MpsLoadMessagesStep=a}),98);
__d("ReQLObservable",["SortedAsyncIterable","applyChangesToBPlusTree","createBPlusTreeFromSorted","isPromise","promiseDone","relay-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("relay-runtime").Observable.create(function(e){var f=b(a),g=function(a){if(e.closed)return;e.next(a)},i,j=[],k=f.subscribe(function(a,b){j.push([a,b])}),l=a.subscribeToCommit(function(){if(e.closed)return;if(i!=null&&j.length>0){var a=i;c("applyChangesToBPlusTree")(a,j)&&g(Array.from(a.entries()))}}),m=f.iterator(d("SortedAsyncIterable").getOrCreateContext(f)),n=[];c("promiseDone")(async function(){while(!e.closed){var a=m.next();(h||(h=c("isPromise")))(a)&&(a=await a);if(a.done)break;n.push(a.value)}if(e.closed)return;a=i=c("createBPlusTreeFromSorted")(n,f.direction);g(c("applyChangesToBPlusTree")(a,j)?Array.from(a.entries()):n)}());return function(){k(),l()}})}g.create=a}),98);
__d("switchMap",["relay-runtime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("relay-runtime").Observable.create(function(c){var d,e=a.subscribe({complete:c.complete,error:c.error,next:function(a){var e;(e=d)==null?void 0:e.unsubscribe();d=b(a).subscribe(c)}});return function(){var a;(a=d)==null?void 0:a.unsubscribe();e.unsubscribe()}})}g["default"]=a}),98);
__d("MAWMessageRangeDataSourceV2",["FBLogger","I64","LSDatabaseSingleton","LSEncryptedBackupsBackupTenancy","LSIntEnum","MAWEBCombinedSwitch","MAWEBRestoreExtensionStep","MAWEncryptedBackupUtils","MAWLocalAndDeanonExtensionStep","MAWMessageIntegrityEBFetchStatus","MAWMessageIntegrityTruncateStatus","MAWMessageRangeDataExternalObservables","MAWMessagesPaginationUtils","MAWMessagesRangesUtils","MAWMpsGating","MAWMpsM3RangeExtension","MAWPutMessagesToDB","MAWSubscribeToLSTruncateMetadataThreads","MAWWaitForACTThreadReadyForMLv2","MLV2DataSourceLogger","MLV2RangeExtensionLogger","MessageRangeSet","MpsLoadMessagesStep","ReQL","ReQLObservable","err","gkx","nullthrows","qex","relay-runtime","switchMap"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=5,l=function(){function a(a,b){var e=this;this.$2=new(d("MessageRangeSet").MessageRangeSet)();this.$3=k;this.$4=!0;this.$5=new(d("MAWMessageRangeDataExternalObservables").MAWMessageRangeDataExternalObservables)();this.getOrCreateMessageRangeCoveringCursor=function(a,b,c){b==null?void 0:b.annotateMessageRangesDataSource("MAWMessageRangeDataSourceV2");b==null?void 0:b.markQPLPoint("maw_get_or_create_range_start");c=e.$2.getRangeForTimestamp(a.timestampMs);if(c!=null){b==null?void 0:b.markQPLPoint("maw_preexisting_range");b==null?void 0:b.markQPLPoint("maw_get_or_create_range_end");var f={maxExternalId:null,minExternalId:null};return e.$5.getOrCreateExternalObservableForRange(c,f)}c=(h||(h=d("I64"))).equal(a.timestampMs,h.max_int);f={hasMoreAfter:!c,hasMoreBefore:!0,isLoadingAfter:!1,isLoadingBefore:!1,maxMessageId:(f=a.messageId)!=null?f:"",maxTimestampMs:a.timestampMs,minMessageId:(c=a.messageId)!=null?c:"",minTimestampMs:a.timestampMs,threadKey:e.$1};c=e.$2.upsertRange(f);d("MAWMessageIntegrityTruncateStatus").setThreadLastUpsertedRange(e.$1,f,{maxExternalId:a==null?void 0:a.externalId,minExternalId:a==null?void 0:a.externalId});b==null?void 0:b.markQPLPoint("maw_range_created");b==null?void 0:b.markQPLPoint("maw_get_or_create_range_end");return e.$5.getOrCreateExternalObservableForRange(c,{maxExternalId:a==null?void 0:a.externalId,minExternalId:a==null?void 0:a.externalId})};this.$6=function(a){var b=d("MLV2DataSourceLogger").getMLV2LoggerForThread(e.$1,a),c=d("MLV2RangeExtensionLogger").getRangeExtensionLoggerForThread(e.$1,a);a={addQPLAnnotations:function(a){b==null?void 0:b.addQPLAnnotations(a),c==null?void 0:c.addQPLAnnotations(a)},annotateMessageRangesDataSource:function(a){b==null?void 0:b.annotateMessageRangesDataSource(a),c==null?void 0:c.annotateMessageRangesDataSource(a)},getInstanceKey:function(){var a;return(a=b==null?void 0:b.getInstanceKey())!=null?a:0},markQPLCancel:function(a){b==null?void 0:b.markQPLCancel(a),c==null?void 0:c.markQPLCancel(a)},markQPLFailure:function(a){b==null?void 0:b.markQPLFailure(a),c==null?void 0:c.markQPLFailure(a)},markQPLFailureWithMsg:function(a){b==null?void 0:b.markQPLFailureWithMsg(a),c==null?void 0:c.markQPLFailureWithMsg(a)},markQPLPoint:function(a,d){b==null?void 0:b.markQPLPoint(a,d),c==null?void 0:c.markQPLPoint(a,d)},markQPLSuccess:function(a){b==null?void 0:b.markQPLSuccess(a),c==null?void 0:c.markQPLSuccess()}};return a};this.extendRange=async function(a,b,c,f,g){var i=e.$6(c);i==null?void 0:i.annotateMessageRangesDataSource("MAWMessageRangeDataSourceV2");i==null?void 0:i.markQPLPoint("maw_v2_extend_range_start");var j=e.$2.getRangeForTimestamp(a.minTimestampMs);if(j==null){i==null?void 0:i.markQPLPoint("extend_range_invalid");return Promise.resolve()}var k=j.value;a=await d("MAWMessagesPaginationUtils").getMessagesRangesV2ExternalIdsIfChanged(a,k,b);if(c==="asc"&&(!k.hasMoreAfter||k.isLoadingAfter)){i==null?void 0:i.markQPLPoint("extend_range_skipped");return Promise.resolve()}if(c==="desc"&&(!k.hasMoreBefore||k.isLoadingBefore)){i==null?void 0:i.markQPLPoint("extend_range_skipped");return Promise.resolve()}b=e.$5.getOrCreateExternalObservableForRange(j,a);b.next({range:babelHelpers.extends({},k,{isLoadingAfter:k.isLoadingAfter||c==="asc",isLoadingBefore:k.isLoadingBefore||c==="desc"}),rangeExternalIds:a});var l={maxMessageId:j.value.maxMessageId,maxTimestampMs:j.value.maxTimestampMs,minMessageId:j.value.minMessageId,minTimestampMs:j.value.minTimestampMs};return e.$7(j.value,a,b,c,f,g).then(function(){var a=(h||(h=d("I64"))).equal(l.maxTimestampMs,j.value.maxTimestampMs)&&(h||(h=d("I64"))).equal(l.minTimestampMs,j.value.minTimestampMs)&&j.value.maxMessageId===l.maxMessageId&&j.value.minMessageId===l.minMessageId;i==null?void 0:i.addQPLAnnotations({bool:{extended_range_is_identical:a}})}).catch(function(a){i==null?void 0:i.markQPLPoint("extend_range_failed");i==null?void 0:i.addQPLAnnotations({string:{range_extension_error:a instanceof Error?a.message:"unknown_error"}});throw a})};this.$7=async function(a,b,c,f,g,h){var j=await (i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton,k=e.$6(f);k==null?void 0:k.markQPLPoint("maw_wait_act_thread_start");var l=await d("MAWWaitForACTThreadReadyForMLv2").waitForACTThreadReadyForMLv2(j.tables,e.$1,"MAWMessageRangeDataSourceV2",k);l=l.chatJid;k==null?void 0:k.markQPLPoint("maw_wait_act_thread_end");var m=e.$8(),n=null;for(m of m){var o=m.name,p=m.step;p=await e.$9(p,o,{chatJid:l,count:g,db:j,direction:f,dispatch:h,logger:k,oldRange:a,oldRangeExternalIds:b,prevResponse:n},c);if(p.shouldTerminate)return;n=p.extension}};this.$9=async function(a,b,f,g){var h=f.db,i=f.direction,j=f.dispatch,k=f.logger,l=f.oldRange,m=f.oldRangeExternalIds;k==null?void 0:k.markQPLPoint("maw_range_"+b+"_start");a=await a(f);k==null?void 0:k.markQPLPoint("maw_range_"+b+"_end");if(a.status==="try_again"){k==null?void 0:k.markQPLPoint("maw_range_"+b+"_retry");if(c("gkx")("7409")&&e.$3>0){k==null?void 0:k.markQPLPoint("maw_range_"+b+"_timed_out");e.$3-=1;g.next({range:babelHelpers.extends({},l,{isLoadingAfter:!1,isLoadingBefore:!1}),rangeExternalIds:m});return{shouldTerminate:!0}}throw c("err")("Timed out for step: "+b)}if(a.status==="complete"){k==null?void 0:k.markQPLPoint("insert_msgs_to_lsdb_start");await d("MAWPutMessagesToDB").insertMessageResponseIntoDatabase(h,a.extension,j,k==null?void 0:k.getInstanceKey());k==null?void 0:k.markQPLPoint("insert_msgs_to_lsdb_end");k==null?void 0:k.markQPLPoint("maw_upsert_range_start");e.$10(l,m,g,i,a.extension);k==null?void 0:k.markQPLPoint("maw_upsert_range_end");return{shouldTerminate:!0}}if(a.status==="complete_with_range_override"){k==null?void 0:k.markQPLPoint("insert_msgs_to_lsdb_start");await d("MAWPutMessagesToDB").insertMessageResponseIntoDatabase(h,a.extension,j,k==null?void 0:k.getInstanceKey());k==null?void 0:k.markQPLPoint("insert_msgs_to_lsdb_end");k==null?void 0:k.markQPLPoint("maw_upsert_range_start");e.$11(g,a.updatedRange,a.updatedRangeExternalIds);k==null?void 0:k.markQPLPoint("maw_upsert_range_end");return{shouldTerminate:!0}}return{extension:a.extension,shouldTerminate:!1}};this.$10=function(a,b,c,f,g){a=d("MAWMessagesRangesUtils").mergeMoreMessagesResponseIntoRange(a,b,g,f);b=a[0];g=a[1];e.$11(c,b,g)};this.$1=a;this.isEBEnabled=b}var b=a.prototype;b.$8=function(){var a,b=this,e={name:"fallback",step:function(a){a=a.prevResponse;return Promise.resolve({extension:c("nullthrows")(a),status:"complete"})}};if(d("MAWMpsGating").isFullMpsEnabled())return[{name:"mps_load_messages",step:d("MpsLoadMessagesStep").MpsLoadMessagesStep},e];if(d("MAWMpsGating").isMpsM3Only())return[{name:"mps_m3_fetch_data",step:d("MAWMpsM3RangeExtension").mpsM3RangeExtension},e];a=(a=c("qex")._("4515"))!=null?a:!1;return[{name:"deanon_and_local_fetch",step:c("MAWLocalAndDeanonExtensionStep")(this.$4&&this.isEBEnabled&&!a)},{name:"eb_restore",step:d("MAWEBRestoreExtensionStep").createEBRestoreExtensionStep({onEBFailure:function(){b.$4=!1,d("MAWMessageIntegrityEBFetchStatus").recordEBFailure(b.$1)},skipEb:a})},e]};b.$11=function(a,b,c){var e=this.$2.upsertRange(b);d("MAWMessageIntegrityTruncateStatus").setThreadLastUpsertedRange(this.$1,b,c);a.next({range:e.value,rangeExternalIds:c})};return a}();function m(a){return d("MAWMpsGating").isMpsM3OrLater()===!0?d("relay-runtime").Observable.create(function(a){var b=d("MAWEBCombinedSwitch").MAWEBCombinedSwitch.onSet(function(b){a.next(b)});a.next(d("MAWEBCombinedSwitch").MAWEBCombinedSwitch.isEnabled());return function(){b()}}):d("ReQLObservable").create(a,function(){return d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state).take(1).map(function(a){var b=d("MAWEncryptedBackupUtils").getBackupTenancyFromClientStateRow(a);b!=null&&a.backupTenancy==null&&c("FBLogger")("messenger_web").warn("Previously broken state of invalid backup tenancy is caught");return b!=null&&(h||(h=d("I64"))).equal(b,(j||(j=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION))})}).map(function(a){return Boolean(a==null?void 0:(a=a[0])==null?void 0:a[1])})}var n=function(){function a(a){var b=this;this.$1=new Map();this.$3=null;this.getOrCreateMessageRangeCoveringCursor=function(a,d,e){var f=a.threadKey;return c("switchMap")(b.$2,function(c){return b.$4(f,c).getOrCreateMessageRangeCoveringCursor(a,d,e)})};this.extendRange=function(a,e,f,g,i){var j=a.threadKey,k=d("MLV2RangeExtensionLogger").startRangeExtensionLoggerForThread(j,f,a,g);if(!b.$1.has((h||(h=d("I64"))).to_string(j))){k.markQPLFailure(c("err")("thread range not found in cache"));return Promise.resolve()}return c("nullthrows")(b.$1.get((h||(h=d("I64"))).to_string(j))).extendRange(a,e,f,g,i).then(function(){k.markQPLSuccess()}).catch(function(a){k.markQPLFailure(a);throw a})};this.$2=m(a);this.$3=d("MAWSubscribeToLSTruncateMetadataThreads").subscribeToLSTruncateMetadataThreads(a,function(a,c){a=(h||(h=d("I64"))).to_string(c);b.$1.delete(a)&&d("MAWMessageIntegrityTruncateStatus").setThreadThuncated(c)})}var b=a.prototype;b.$4=function(a,b){var e=(h||(h=d("I64"))).to_string(a);if(!this.$1.has(e)){var f=new l(a,b);this.$1.set(e,f)}f=c("nullthrows")(this.$1.get(e));f.isEBEnabled!==b&&(f=new l(a,b),this.$1.set(e,f));return f};return a}(),o,p;function a(a){(o==null||p!==a)&&(p=a,o=new n(a));return o}g.default=a}),98);
__d("MWPFetchMessagesThreadLocks",["FBLogger","I64"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var e=(h||(h=d("I64"))).to_string(b);return{lock:{after:function(){var b=f();b.after===!0&&c("FBLogger")("messenger_web").mustfix("Locking threadLockStatus twice");b.after=!0;a.set(e,b)},before:function(){var b=f();b.before===!0&&c("FBLogger")("messenger_web").mustfix("Locking threadLockStatus twice");b.before=!0;a.set(e,b)}},release:{after:function(){var b=f();b.after=!1;a.set(e,b)},before:function(){var b=f();b.before=!1;a.set(e,b)}},state:f()};function f(){var b=a.get(e);b==null&&(b={after:!1,before:!1},a.set(e,b));return b}}g.localThreadStatus=a}),98);
__d("MWPFetchMessagesPageV2",["FBLogger","LSFactory","LSIntEnum","LSIssueMessagesRangeQueryStoredProcedure","LSMailboxMessagesRangeQueryDirection","LSMessagingThreadTypeUtil","MWPFetchMessagesThreadLocks","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b,e,f,g,h,i,j,m){var n,o;n=await (n=a.tables.messages_ranges_v2__generated).get.apply(n,f);if(n==null)return;o=h&&await (o=a.tables.messages_ranges_v2__generated).get.apply(o,h);if(o==null&&h!=null)return;h=d("LSMessagingThreadTypeUtil").isArmadilloSecure(g);var p=i!=null?d("LSMessagingThreadTypeUtil").isArmadilloSecure(i):!1;if(e==="before")if(n.hasMoreBefore)if(h)return k(a,b,e,n,j,g,m);else return l(a,f,n.threadKey,e);else if(o!=null)if(p)return k(a,b,e,o,j,g,m);else return l(a,[o.threadKey,o.minTimestampMs,o.minMessageId],o.threadKey,e);else return;else{e;if(n.hasMoreAfter)if(h)throw c("FBLogger")("messenger_web").mustfix("Not possible to fetch more after for secure messages");else return l(a,f,n.threadKey,e);else if(o!=null){p=d("LSMessagingThreadTypeUtil").isArmadilloSecure(c("nullthrows")(i));if(p)throw c("FBLogger")("messenger_web").mustfix("Not possible to fetch more after for secure messages");else return l(a,[o.threadKey,o.minTimestampMs,o.minMessageId],o.threadKey,e)}else return}}var i=new Map(),j=new Map();async function k(a,b,c,e,f,g,h){var j=d("MWPFetchMessagesThreadLocks").localThreadStatus(i,e.threadKey);if(j.state[c])return;try{j.lock[c]();var k=await a.tables.messages.index("messageId").get(e.minMessageId);return await f.fetchSecureMessagesProtocol(a,e.threadKey,g,k==null?void 0:k.primarySortKey,e,c,b,"user",h)}finally{j.release[c]()}}async function l(a,b,e,g){e=d("MWPFetchMessagesThreadLocks").localThreadStatus(j,e);if(e.state[g])return;try{e.lock[g]();return await a.runInTransaction(async function(a){var e;e=await (e=a.messages_ranges_v2__generated).get.apply(e,b);if(!e)return;if(e.isLoadingBefore&&g==="before")return;if(e.isLoadingAfter&&g==="after")return;return c("LSIssueMessagesRangeQueryStoredProcedure")(c("LSFactory")(a),{direction:(h||(h=d("LSIntEnum"))).ofNumber(g==="before"?c("LSMailboxMessagesRangeQueryDirection").BEFORE:c("LSMailboxMessagesRangeQueryDirection").AFTER),referenceTimestampMs:e.minTimestampMs,threadKey:e.threadKey})},"readwrite","ui",void 0,f.id+":209")}finally{e.release[g]()}}g.default=a}),98);
__d("MAWPreloadSecureMessages",["I64","LSAuthorityLevel","LSIntEnum","LSResult","MAWMessagesDirection","MWPFetchMessagesPageV2","MWV2OnAuthoritativeThreadInsert","ReQL","cr:13911","cr:13912"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=b("cr:13911")!=null?new(b("cr:13911"))():null,k=async function(a,e,f,g,k,l,m){var n=await d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.tables.messages_ranges_v2__generated).getKeyRange(e));n=n!=null?[e,n==null?void 0:n.minTimestampMs,n==null?void 0:n.minMessageId]:null;g=g!=null?await d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.tables.messages_ranges_v2__generated).getKeyRange(g)):null;g=g!=null?[g==null?void 0:g.threadKey,g==null?void 0:g.minTimestampMs,g==null?void 0:g.minMessageId]:null;var o=(h||(h=d("I64"))).equal(f,(i||(i=d("LSIntEnum"))).ofNumber(15))?(i||(i=d("LSIntEnum"))).ofNumber(1):(i||(i=d("LSIntEnum"))).ofNumber(2);if(b("cr:13912")!=null){var p;if(!(h||(h=d("I64"))).equal(m,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE)))return Promise.resolve();var q=b("cr:13912")(a),r;m=await new Promise(function(a,b){r=q.getOrCreateMessageRangeCoveringCursor({externalId:null,messageId:null,threadKey:e,timestampMs:(h||(h=d("I64"))).max_int},void 0,k).subscribe({complete:a,error:b,next:function(b){a(b)}})});(p=r)==null?void 0:p.unsubscribe();if(m&&d("MAWMessagesDirection").isFirstPageRange(m.range,"desc"))return q.extendRange(m.range,{maxExternalId:null,minExternalId:null},"desc",l,k)}else if(j!=null)return n!=null?c("MWPFetchMessagesPageV2")(a,l,"before",n,f,g,o,j,k):Promise.resolve()},l=async function(a,b){b=await d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.tables.threads).getKeyRange(b));if(b==null)return null;if((h||(h=d("I64"))).equal(b.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE)))return b;var e=b.clientThreadKey;return e!=null?new Promise(function(b){d("MWV2OnAuthoritativeThreadInsert").onAuthoritativeThreadInsert(c("LSResult")(e),a,function(a){return b(a)})}):null};a=async function(a,b,c,d){b=await l(a,b);return b==null?Promise.resolve():k(a,b.threadKey,b.threadType,null,c,d,b.authorityLevel)};g.preloadSecureMessages=k;g.preloadSecureMessagesByThreadKey=a}),98);
__d("MAWPreloadSecureMessagesEager",["MAWPreloadSecureMessages","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return(h||(h=b("Promise"))).resolve(d("MAWPreloadSecureMessages").preloadSecureMessages)}g.load=a}),98);
__d("MAWPreloadSecureMessagesRangeDataSource",["MAWMessageRangeDataSourceV2"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=c("MAWMessageRangeDataSourceV2")}),98);
__d("MWGetChatTabOpenQPLEventTrace",["I64","InteractionTracing","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var e=c("qpl")._(30609204,"1682"),f=c("qpl")._(30605380,"18"),g=c("InteractionTracing").getPendingInteractions();for(g of g){var i;if(((i=g.getTrace())==null?void 0:i.qplEvent)===e||((i=g.getTrace())==null?void 0:i.qplEvent)===f){((i=g.getTrace())==null?void 0:(i=i.annotations.string)==null?void 0:i.thread_id)===(h||(h=d("I64"))).to_string(a)&&b(g)}}}g["default"]=a}),98);
__d("MWEnsureCutoverOpenThreadExists",["Int64Hooks","LSFactory","LSIntEnum","LSVerifyThreadRowExistsStoredProcedure","MAWThreadCutover","MWGetChatTabOpenQPLEventTrace","ReQL","ReQLSuspense","promiseDone","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;async function a(a,b){b=await d("ReQL").firstAsync(d("MAWThreadCutover").getMiActMappings(a,b));if(b==null)return;b=await d("ReQL").firstAsync(d("MAWThreadCutover").getCutoverThreadsByJid(a,b.jid));if(b==null)return;var e=b.openThreadId;b=await d("ReQL").firstAsync(d("MAWThreadCutover").getThreadByCutoverThread(a,b));if(b==null)return a.runInTransaction(function(a){return c("LSVerifyThreadRowExistsStoredProcedure")(c("LSFactory")(a),{syncGroup:(i||(i=d("LSIntEnum"))).ofNumber(1),threadKey:e})},"readwrite",void 0,void 0,f.id+":54")}function b(a){var b=d("react-compiler-runtime").c(10),e=(h||(h=c("useReStore")))(),g=d("MAWThreadCutover").useGetCutoverOpenThreadKey(a),k,l;b[0]!==e||b[1]!==g?(k=function(){return g==null?d("ReQL").empty():d("ReQL").fromTableAscending(e.tables.threads).getKeyRange(g)},l=[e,g],b[0]=e,b[1]=g,b[2]=k,b[3]=l):(k=b[2],l=b[3]);var m=d("ReQLSuspense").useFirst(k,l,f.id+":68");b[4]!==m||b[5]!==e||b[6]!==g||b[7]!==a?(k=function(){m==null&&g!=null&&c("promiseDone")(e.runInTransaction(function(a){return c("LSVerifyThreadRowExistsStoredProcedure")(c("LSFactory")(a),{syncGroup:(i||(i=d("LSIntEnum"))).ofNumber(1),threadKey:g})},"readwrite",void 0,void 0,f.id+":78"),function(){c("MWGetChatTabOpenQPLEventTrace")(a,j)})},l=[m,e,g,a],b[4]=m,b[5]=e,b[6]=g,b[7]=a,b[8]=k,b[9]=l):(k=b[8],l=b[9]);d("Int64Hooks").useEffectInt64(k,l)}function j(a){a.addMarkerPoint("requested_cutover_open_thread","AppTiming")}g.ensureCutoverOpenThreadExists=a;g.useMWEnsureCutoverOpenThreadExists=b}),98);
__d("withCometPlaceholder",["CometPlaceholder.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");a=function(a,b,d){b===void 0&&(b=null);return function(e){return i.jsx(c("CometPlaceholder.react"),{fallback:b,name:d,children:i.jsx(a,babelHelpers["extends"]({},e))})}};g.withCometPlaceholder=a}),98);
__d("MWPPresenceBadge.react",["fbt","BaseStyledBadge.react","MessengerMSplitFlag","react","react-compiler-runtime","withCometPlaceholder"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");b=d("withCometPlaceholder").withCometPlaceholder(a,null,"MWPPresenceBadge");var k={border:{borderTopColor:"x6zyg47",borderInlineEndColor:"x1lu4ftm",borderBottomColor:"xpn8fn3",borderInlineStartColor:"x114g2xr",$$css:!0},green:{backgroundColor:"xv9rvxn",$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(4),e=a.borderThemeColor,f=a.isActiveStatePresence;a=a.size;var g;b[0]!==e||b[1]!==f||b[2]!==a?(g=!c("MessengerMSplitFlag").is_msplit_account&&f?j.jsx(c("BaseStyledBadge.react"),{accessibilityText:h._(/*BTDS*/"Active now"),border:!0,colorXStyle:k.green,size:a,xstyle:e!=null?e:k.border}):null,b[0]=e,b[1]=f,b[2]=a,b[3]=g):g=b[3];return g}g["default"]=b}),226);
__d("MWPReQLPresenceBadge.react",["MWPPresenceBadge.react","cr:7905","react","react-compiler-runtime","withCometPlaceholder"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");e=d("withCometPlaceholder").withCometPlaceholder(a,null,"MWPReQLPresenceBadge");function a(a){var e=d("react-compiler-runtime").c(4),f=a.borderThemeColor,g=a.size;a=a.threadKey;a=b("cr:7905")(a);var h;e[0]!==f||e[1]!==a||e[2]!==g?(h=i.jsx(c("MWPPresenceBadge.react"),{borderThemeColor:f,isActiveStatePresence:a,size:g}),e[0]=f,e[1]=a,e[2]=g,e[3]=h):h=e[3];return h}g["default"]=e}),98);
__d("MWFacepileBadge.react",["CometPlaceholder.react","MWPReQLPresenceBadge.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(4),e=a.borderThemeColor,f=a.size;a=a.threadKey;var g;b[0]!==e||b[1]!==f||b[2]!==a?(g=i.jsx(c("CometPlaceholder.react"),{fallback:null,name:"MWFacepileBadge",children:i.jsx(c("MWPReQLPresenceBadge.react"),{borderThemeColor:e,size:f,threadKey:a})}),b[0]=e,b[1]=f,b[2]=a,b[3]=g):g=b[3];return g}g["default"]=a}),98);
__d("MWPContactContext.react",["react","react-compiler-runtime","shallowEqualI64"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));e=h;var j=e.useContext;e.useMemo;var k=e.useRef,l=i.createContext({authorName:void 0,contact:void 0,nickname:void 0}),m=i.createContext({authorName:void 0,contact:void 0,nickname:void 0});function a(){return j(l)}function b(){return j(m)}function c(a){var b=d("react-compiler-runtime").c(14),c=a.children,e=a.contact;a=a.nickname;var f;if(a!=null)f=a;else if(e!=null){var g=e.firstName;f=g!=null?g:e.name}else f=void 0;g=f;f=g;b[0]!==f||b[1]!==e||b[2]!==a?(g={authorName:f,contact:e,nickname:a},b[0]=f,b[1]=e,b[2]=a,b[3]=g):g=b[3];g=g;g=g;e=n(e);var h;b[4]!==f||b[5]!==a||b[6]!==e?(h={authorName:f,contact:e,nickname:a},b[4]=f,b[5]=a,b[6]=e,b[7]=h):h=b[7];f=h;a=f;b[8]!==c||b[9]!==a?(e=i.jsx(m.Provider,{value:a,children:c}),b[8]=c,b[9]=a,b[10]=e):e=b[10];b[11]!==g||b[12]!==e?(h=i.jsx(l.Provider,{value:g,children:e}),b[11]=g,b[12]=e,b[13]=h):h=b[13];return h}function n(a){var b=k();a=a?{blockedByViewerStatus:a.blockedByViewerStatus,capabilities:a.capabilities,capabilities2:a.capabilities2,contactTypeExact:a.contactTypeExact,name:a.name,profilePictureFallbackUrl:a.profilePictureFallbackUrl,profilePictureUrl:a.profilePictureUrl,profilePictureUrlExpirationTimestampMs:a.profilePictureUrlExpirationTimestampMs,secondaryName:a.secondaryName}:void 0;d("shallowEqualI64").shallowEqualI64(b.current,a)||(b.current=a);return b.current}g.useMWPContactFullContext=a;g.useMWPContactStableContext=b;g.MWPContactContextProvider=c}),98);
__d("MWGroupBlockingProtectionUtils",["fbt","I64","LSContactBlockedByViewerStatus","LSIntEnum","MWPContactContext.react","ReQL","ReQLSuspense","react-compiler-runtime","recoverableViolation","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k;function l(a){var b=d("react-compiler-runtime").c(8),e=(k||(k=c("useReStore")))(),g;b[0]!==e.tables.threads||b[1]!==a?(g=function(){return d("ReQL").fromTableAscending(e.tables.threads,["threadType"]).getKeyRange(a).map(m)},b[0]=e.tables.threads,b[1]=a,b[2]=g):g=b[2];var h;b[3]!==e||b[4]!==a?(h=[e,a],b[3]=e,b[4]=a,b[5]=h):h=b[5];g=d("ReQLSuspense").useFirst(g,h,f.id+":30");if(g==null)return!1;b[6]!==g?(h=(i||(i=d("I64"))).equal(g,(j||(j=d("LSIntEnum"))).ofNumber(2))||(i||(i=d("I64"))).equal(g,(j||(j=d("LSIntEnum"))).ofNumber(16))||(i||(i=d("I64"))).equal(g,(j||(j=d("LSIntEnum"))).ofNumber(18)),b[6]=g,b[7]=h):h=b[7];return h}function m(a){return a.threadType}function a(a){a=l(a);var b=d("MWPContactContext.react").useMWPContactStableContext();b=b.contact;return a&&b?!(i||(i=d("I64"))).equal(b.blockedByViewerStatus,(j||(j=d("LSIntEnum"))).ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED)):!1}function b(a,b){var e=d("react-compiler-runtime").c(4),g=(k||(k=c("useReStore")))(),h,m;e[0]!==g||e[1]!==a?(h=function(){return a!=null?d("ReQL").fromTableAscending(g.tables.contacts).getKeyRange(a):d("ReQL").empty()},m=[g,a],e[0]=g,e[1]=a,e[2]=h,e[3]=m):(h=e[2],m=e[3]);e=d("ReQLSuspense").useFirst(h,m,f.id+":69");h=l(b);return h&&e?!(i||(i=d("I64"))).equal(e.blockedByViewerStatus,(j||(j=d("LSIntEnum"))).ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED)):!1}function e(a,b){var e,g=d("react-compiler-runtime").c(8),l=(k||(k=c("useReStore")))(),m=(e=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableDescending(l.tables.messages).getKeyRange(a)},[l,a],f.id+":92"))==null?void 0:e.senderId;g[0]!==l.tables.contacts||g[1]!==m?(e=function(){return m!=null?d("ReQL").fromTableAscending(l.tables.contacts).getKeyRange(m):d("ReQL").empty()},g[0]=l.tables.contacts,g[1]=m,g[2]=e):e=g[2];var n;g[3]!==l||g[4]!==m?(n=[l,m],g[3]=l,g[4]=m,g[5]=n):n=g[5];e=d("ReQLSuspense").useFirst(e,n,f.id+":96");n=e==null?!1:!(i||(i=d("I64"))).equal(e.blockedByViewerStatus,(j||(j=d("LSIntEnum"))).ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED));b=(i||(i=d("I64"))).equal(b,(j||(j=d("LSIntEnum"))).ofNumber(2))||(i||(i=d("I64"))).equal(b,(j||(j=d("LSIntEnum"))).ofNumber(16))||(i||(i=d("I64"))).equal(b,(j||(j=d("LSIntEnum"))).ofNumber(18));if(!(b&&n))return null;n=(b=e==null?void 0:e.firstName)!=null?b:e==null?void 0:e.name;if(n==null){c("recoverableViolation")("Empty first name for blocked contact","messenger_web_wellbeing");return null}g[6]!==n?(b=h._(/*BTDS*/"{blocked contact's name} sent a message.",[h._param("blocked contact's name",n)]).toString(),g[6]=n,g[7]=b):b=g[7];return b}g.useShouldEnableBlockingProtection=l;g.useMWGetSnippetForBlockingProtection=e;g.useMWIsContactBlocked=a;g.useMWIsMessageSentByBlockedContact=b}),226);
__d("getMWLSThreadEventTimeSnippetForDisplay",["fbt","I64"],(function(a,b,c,d,e,f,g,h){"use strict";var i;function j(a){switch(a){case 0:return"Sunday";case 1:return"Monday";case 2:return"Tuesday";case 3:return"Wednesday";case 4:return"Thursday";case 5:return"Friday";case 6:return"Saturday";default:return""}}function k(a){a=a.split(":");var b=a.slice(0,2).join(":");a=a[2].slice(2,5);return b+a}function a(a,b){var c=Date.now();a=a!=null?(i||(i=d("I64"))).to_float(a):0;b=b!=null?(i||(i=d("I64"))).to_float(b):a*2;var e=new Date(a),f=a-6048e5,g=a-864e5,l=c<=f;g=c<=a&&c>=g;f=c<=a&&c>=f&&!g;a=c>=a&&c<=b;c=e.toDateString();b=k(e.toLocaleTimeString());c=c.split(" ");e=e.getDay();var m=new Date();m=m.getDate();if(l)return h._(/*BTDS*/"Event {month} {day} at {time}",[h._param("month",c[2]),h._param("day",c[1]),h._param("time",b)]).toString();if(f)return h._(/*BTDS*/"Event {day of week} at {time}",[h._param("day of week",j(e)),h._param("time",b)]).toString();if(g)return m!==e?h._(/*BTDS*/"Event tomorrow at {time}",[h._param("time",b)]).toString():h._(/*BTDS*/"Event today at {time}",[h._param("time",b)]).toString();return a?h._(/*BTDS*/"Event happening now").toString():h._(/*BTDS*/"Event has passed").toString()}g["default"]=a}),226);
__d("MWThreadSnippetForDisplay.react",["CometTextWithEntities.react","I64","Int64Hooks","LSMessagingThreadTypeUtil","MWCMThreadTypes.react","MWChatTextTransform","MWGroupBlockingProtectionUtils","ReStoreVaulting","ThreadStatus","cr:4217","getMWLSThreadEventTimeSnippetForDisplay","react","react-compiler-runtime","useStringWithSubstitutions"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||d("react");function a(a){return null}var k=(b=b("cr:4217"))!=null?b:a;function e(a){var b=d("react-compiler-runtime").c(8),e=a.snippetRaw;a=a.thread;var f=d("MWCMThreadTypes.react").isUnjoinedCMThread(a.threadType),g=k(a),h=d("LSMessagingThreadTypeUtil").isArmadilloSecure(a.threadType);if(b[0]!==g||b[1]!==e){var l;l=e==null?null:g!=null?g:((l=d("ReStoreVaulting").maybeUnvault(e))!=null?l:e).replace(/\uDB80\uDC00/,"(Y)");b[0]=g;b[1]=e;b[2]=l}else l=b[2];g=l;e=d("MWGroupBlockingProtectionUtils").useMWGetSnippetForBlockingProtection(a.threadKey,a.threadType);h=(l=d("useStringWithSubstitutions").useStringWithSubstitutions(h?g:null,a.threadKey))!=null?l:g;if(h==null)return null;l=a.threadStatus!=null&&(i||(i=d("I64"))).equal(a.threadStatus,(i||(i=d("I64"))).of_int32(c("ThreadStatus").PAUSED));if(!f&&!l&&a.eventStartTimestampMs!=null){b[3]!==a.eventEndTimestampMs||b[4]!==a.eventStartTimestampMs?(g=c("getMWLSThreadEventTimeSnippetForDisplay")(a.eventStartTimestampMs,a.eventEndTimestampMs),b[3]=a.eventEndTimestampMs,b[4]=a.eventStartTimestampMs,b[5]=g):g=b[5];return g}if(e!=null)return e;b[6]!==h?(f=j.jsx(c("CometTextWithEntities.react"),{text:h,transforms:d("MWChatTextTransform").textTransforms}),b[6]=h,b[7]=f):f=b[7];return f}var l=j.memo(e);function f(a){var b=d("react-compiler-runtime").c(4),c=a.snippetRaw;a=a.thread;var e;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=["threadKey","threadType","threadStatus","eventStartTimestampMs","eventEndTimestampMs"],b[0]=e):e=b[0];a=d("Int64Hooks").usePickInt64(a,e);b[1]!==c||b[2]!==a?(e=j.jsx(l,{snippetRaw:c,thread:a}),b[1]=c,b[2]=a,b[3]=e):e=b[3];return e}g["default"]=f}),98);
__d("useGetContactsToShow",["FBLogger","I64","Int64Hooks","LSMessagingThreadTypeUtil","getLSMediaContactProfilePictureUrl","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e){var f=d("react-compiler-runtime").c(30),g;f[0]!==e?(g=function(a){return a.filter(function(a){return!(h||(h=d("I64"))).equal(a.id,e)})},f[0]=e,f[1]=g):g=f[1];g=g;var k=b.length,l,m,n;if(f[2]!==e||f[3]!==b||f[4]!==g||f[5]!==k||f[6]!==a.threadType){var o=[];l=[];if(k!==0){var p=b[0],q=b[1];l=g(b.filter(Boolean).filter(j));bb0:switch(k){case 1:p!=null&&c("getLSMediaContactProfilePictureUrl")(p)!==""&&(o=[p]);break bb0;case 2:d("LSMessagingThreadTypeUtil").isOneToOne(a.threadType)&&l.length===1&&c("getLSMediaContactProfilePictureUrl")(l[0])!==""?o=[l[0]]:d("LSMessagingThreadTypeUtil").isGroup(a.threadType)&&p!=null&&q!=null&&c("getLSMediaContactProfilePictureUrl")(p)!==""&&c("getLSMediaContactProfilePictureUrl")(q)!==""&&(o=[p,q]);break bb0;default:l.length>=2&&(o=l)}}m=d("LSMessagingThreadTypeUtil").isOneToOne(a.threadType)&&l.length===0;if(f[11]!==e||f[12]!==b){f[14]!==e?(p=function(a){return a!=null&&(h||(h=d("I64"))).equal(a.id,e)},f[14]=e,f[15]=p):p=f[15];q=b.find(p);f[11]=e;f[12]=b;f[13]=q}else q=f[13];n=q;p=o.sort(i).slice(0,2);f[2]=e;f[3]=b;f[4]=g;f[5]=k;f[6]=a.threadType;f[7]=l;f[8]=m;f[9]=n;f[10]=p}else l=f[7],m=f[8],n=f[9],p=f[10];var r=p;if(f[16]!==l.length||f[17]!==m||f[18]!==k||f[19]!==r||f[20]!==((q=n)==null?void 0:q.id)||f[21]!==a.threadType){o=function(){var b;k===2&&!m&&d("LSMessagingThreadTypeUtil").isOneToOne(a.threadType)&&r.length===1&&(h||(h=d("I64"))).equal(r[0].id,(b=(b=n)==null?void 0:b.id)!=null?b:(h||(h=d("I64"))).minus_one)&&c("FBLogger")("messenger_web").mustfix("One to one thread with participants is showing self contact. Num contacts without self: %s",l.length)};f[16]=l.length;f[17]=m;f[18]=k;f[19]=r;f[20]=(b=n)==null?void 0:b.id;f[21]=a.threadType;f[22]=o}else o=f[22];f[23]!==l.length||f[24]!==m||f[25]!==k||f[26]!==r||f[27]!==n||f[28]!==a.threadType?(g=[k,m,a.threadType,r,n,l.length],f[23]=l.length,f[24]=m,f[25]=k,f[26]=r,f[27]=n,f[28]=a.threadType,f[29]=g):g=f[29];d("Int64Hooks").useEffectInt64(o,g);return r}function i(a,b){return b.rank-a.rank}function j(a){return c("getLSMediaContactProfilePictureUrl")(a)!==""}g["default"]=a}),98);
__d("useGetSnippetFromLS",["I64","LSAuthorityLevel","LSIntEnum","MAWStrings","ReQL","ReQLSuspense","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a){var b=d("react-compiler-runtime").c(9),e=(j||(j=c("useReStore")))(),g;b[0]!==e.tables.messages||b[1]!==a.threadKey?(g=function(){return d("ReQL").fromTableAscending(e.tables.messages.index("messageDisplayOrderAuthority")).bounds({gte:[a.threadKey,(h||(h=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),(i||(i=d("I64"))).zero],lt:[a.threadKey,h.ofNumber(c("LSAuthorityLevel").OPTIMISTIC),i.max_int]})},b[0]=e.tables.messages,b[1]=a.threadKey,b[2]=g):g=b[2];var k;b[3]!==e||b[4]!==a.threadKey?(k=[e,a.threadKey],b[3]=e,b[4]=a.threadKey,b[5]=k):k=b[5];g=d("ReQLSuspense").useFirst(g,k,f.id+":30");b[6]!==g||b[7]!==a.snippet?(k=g!=null?{shouldHideTimestamp:!0,snippet:d("MAWStrings").MAW_OPTIMISTIC_SNIPPET().toString()}:{shouldHideTimestamp:!1,snippet:a.snippet},b[6]=g,b[7]=a.snippet,b[8]=k):k=b[8];return k}g["default"]=a}),98);
__d("usePrefetchCutoverDependencies",["Int64Hooks","MWEnsureCutoverOpenThreadExists","MWV2EnsureThatChatTabExists","Promise","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,c){var e=d("react-compiler-runtime").c(6),f=c.clientThreadKey,g=c.threadKey,j=c.threadType,k;e[0]!==f||e[1]!==a||e[2]!==g||e[3]!==j?(c=function(){return a.then(function(a){return(h||(h=b("Promise"))).all([d("MWEnsureCutoverOpenThreadExists").ensureCutoverOpenThreadExists(a,g),d("MWV2EnsureThatChatTabExists").ensureThatChatTabExists(a,g,j,f,"usePrefetchCutoverDependencies")]).then(i)})},k=[a,g,j,f],e[0]=f,e[1]=a,e[2]=g,e[3]=j,e[4]=c,e[5]=k):(c=e[4],k=e[5]);return d("Int64Hooks").useCallbackInt64(c,k)}function i(){}g["default"]=a}),98);
__d("useMWPreloadThread",["Int64Hooks","InteractionTracingMetrics","JSResourceForInteraction","JSScheduler","LSFactory","LSIntEnum","LSIssueMessagesRangeQueryStoredProcedure","LSMailboxMessagesRangeQueryDirection","MAWStateContext.react","MWLSThreadDisplayContext","Promise","ReQL","cr:13910","gkx","justknobx","promiseDone","react","react-compiler-runtime","useAsyncReStore","useCometPreloader","usePrefetchCutoverDependencies"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=(k||d("react")).useContext,m=c("JSResourceForInteraction")("MWV2ChatTab.react").__setRef("useMWPreloadThread");function a(a,e){var f=d("react-compiler-runtime").c(19),g=l(d("MAWStateContext.react").MAWDispatchContext),j=c("useAsyncReStore")(),k=d("MWLSThreadDisplayContext").useMWLSThreadDisplayContext(),p=c("usePrefetchCutoverDependencies")(j,a),s;f[0]!==k?(s=k!=="Inbox"&&c("justknobx")._("761"),f[0]=k,f[1]=s):s=f[1];var t=s,u=a.threadKey;f[2]!==j||f[3]!==g||f[4]!==e||f[5]!==t||f[6]!==a.authorityLevel||f[7]!==a.clientThreadKey||f[8]!==a.threadType||f[9]!==u?(k=function(){t&&m.preload();if(e){c("InteractionTracingMetrics").currentInteractionLogger().forEach(q);var d=c("justknobx")._("2575"),f=c("gkx")("14315")?8:c("justknobx")._("2038"),i=t?f:d;c("promiseDone")((h||(h=b("Promise"))).all([j,b("cr:13910").load()]).then(function(b){var c=b[0];b=b[1];return b(c,u,a.threadType,a.clientThreadKey,g,i,a.authorityLevel)}).then(o))}},s=[j,e,t,a.clientThreadKey,g,a.threadType,u,a.authorityLevel],f[2]=j,f[3]=g,f[4]=e,f[5]=t,f[6]=a.authorityLevel,f[7]=a.clientThreadKey,f[8]=a.threadType,f[9]=u,f[10]=k,f[11]=s):(k=f[10],s=f[11]);k=d("Int64Hooks").useCallbackInt64(k,s);var v;f[12]!==j||f[13]!==e||f[14]!==p||f[15]!==t||f[16]!==u?(s=function(){var a=!1;return function(){if(a===!0)return;a=!0;t&&(i||(i=d("JSScheduler"))).scheduleSpeculativeCallback(n);e?c("promiseDone")(p()):c("promiseDone")(j.then(function(a){return r(a,u)}))}},v=[t,e,p,j,u],f[12]=j,f[13]=e,f[14]=p,f[15]=t,f[16]=u,f[17]=s,f[18]=v):(s=f[17],v=f[18]);f=d("Int64Hooks").useMemoInt64(s,v);return c("useCometPreloader")("button",f,k)}function n(){m.preload()}function o(){c("InteractionTracingMetrics").currentInteractionLogger().forEach(p)}function p(a){c("InteractionTracingMetrics").addMarkerPoint(a.traceId,"fetch_messages_page_end","AppTiming")}function q(a){c("InteractionTracingMetrics").addMarkerPoint(a.traceId,"fetch_messages_page_start","AppTiming")}function r(a,b){return a.runInTransaction(function(a){return d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.messages_ranges_v2__generated).getKeyRange(b)).then(function(e){if(e!=null&&e.minMessageId===e.maxMessageId)return c("LSIssueMessagesRangeQueryStoredProcedure")(c("LSFactory")(a),{direction:(j||(j=d("LSIntEnum"))).ofNumber(c("LSMailboxMessagesRangeQueryDirection").BEFORE),referenceTimestampMs:e.minTimestampMs,threadKey:b})})},"readwrite",void 0,void 0,f.id+":160")}g["default"]=a}),98);
__d("useNewestMessageOrReactionTs",["I64","Int64Hooks","ReQL","ReQLSuspense","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var b=d("react-compiler-runtime").c(18),e=(i||(i=c("useReStore")))(),g;b[0]!==e.tables.messages||b[1]!==a?(g=function(){return d("ReQL").fromTableDescending(e.tables.messages).getKeyRange(a)},b[0]=e.tables.messages,b[1]=a,b[2]=g):g=b[2];var j;b[3]!==e||b[4]!==a?(j=[e,a],b[3]=e,b[4]=a,b[5]=j):j=b[5];var k=d("ReQLSuspense").useFirst(g,j,f.id+":23");b[6]!==e.tables.reactions||b[7]!==a?(g=function(){return d("ReQL").fromTableDescending(e.tables.reactions).getKeyRange(a)},b[6]=e.tables.reactions,b[7]=a,b[8]=g):g=b[8];b[9]!==e||b[10]!==a?(j=[e,a],b[9]=e,b[10]=a,b[11]=j):j=b[11];var l=d("ReQLSuspense").useFirst(g,j,f.id+":29");b[12]!==(k==null?void 0:k.timestampMs)||b[13]!==(l==null?void 0:l.timestampMs)?(g=function(){var a;return(h||(h=d("I64"))).max((a=k==null?void 0:k.timestampMs)!=null?a:(h||(h=d("I64"))).zero,(a=l==null?void 0:l.timestampMs)!=null?a:(h||(h=d("I64"))).zero)},b[12]=k==null?void 0:k.timestampMs,b[13]=l==null?void 0:l.timestampMs,b[14]=g):g=b[14];j=k==null?void 0:k.timestampMs;var m=l==null?void 0:l.timestampMs,n;b[15]!==j||b[16]!==m?(n=[j,m],b[15]=j,b[16]=m,b[17]=n):n=b[17];return d("Int64Hooks").useMemoInt64(g,n)}g["default"]=a}),98);
__d("useMWThreadSnippetForDisplay",["FBLogger","I64","LSMessagingThreadTypeUtil","MAWAdminMsg","MAWAdminMsgCTA","MAWLocalizationType","MAWODSProxy","MAWThreadCutover","WAOdsEnums","gkx","react","react-compiler-runtime","useGetSnippetFromLS","useNewestMessageOrReactionTs"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||d("react")).useEffect;function a(a){var b=d("react-compiler-runtime").c(15),e=k(a),f=e.isOpenThreadSnippet,g=e.lastMessageCtaType,h=e.shouldHideTimestamp,i=e.snippet;b[0]!==a.threadType?(e=d("LSMessagingThreadTypeUtil").isArmadilloSecure(a.threadType),b[0]=a.threadType,b[1]=e):e=b[1];var m=e;b[2]!==f||b[3]!==m||b[4]!==i?(e=function(){i===""&&m?(c("FBLogger")("messenger_web").mustfix("[MS5] Snippet is %s","empty"),d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_TC_MS5_OPEN_SNIPPET,key:"snippet_is_empty"})):i==null&&m?(c("FBLogger")("messenger_web").mustfix("[MS5] Snippet is %s","null"),d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_TC_MS5_OPEN_SNIPPET,key:"snippet_is_null"})):m&&(i===l||i===n)?q(i===n):f!=null&&f&&(d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_TC_MS5_OPEN_SNIPPET,key:"open_thread_snippet"}),c("FBLogger")("messenger_web").info("[MS5] Open thread snippet used for secure thread"),(i==null||i==="")&&c("FBLogger")("messenger_web").mustfix("[MS5] Open thread snippet cannot be empty or null"))},b[2]=f,b[3]=m,b[4]=i,b[5]=e):e=b[5];var o;b[6]!==f||b[7]!==m||b[8]!==i||b[9]!==a.threadKey?(o=[i,m,a.threadKey,f],b[6]=f,b[7]=m,b[8]=i,b[9]=a.threadKey,b[10]=o):o=b[10];j(e,o);b[11]!==g||b[12]!==h||b[13]!==i?(a={lastMessageCtaType:g,shouldHideTimestamp:h,snippet:i},b[11]=g,b[12]=h,b[13]=i,b[14]=a):a=b[14];return a}function k(a){var b=d("react-compiler-runtime").c(22),e=c("useGetSnippetFromLS")(a),f;b[0]!==a.threadType?(f=d("LSMessagingThreadTypeUtil").isArmadilloSecure(a.threadType),b[0]=a.threadType,b[1]=f):f=b[1];var g=f,h=d("MAWThreadCutover").useCutoverOpenThread(a.threadKey);f=h==null?void 0:h.threadKey;var k=d("MAWThreadCutover").useIsDualThreadCutoverOpenThread(f);f=(f=c("useNewestMessageOrReactionTs")(a.threadKey))!=null?f:(i||(i=d("I64"))).zero;f=f;if(c("gkx")("10552")){var l=g&&(a.snippet===""||a.snippet==null);f=l?(i||(i=d("I64"))).zero:a.lastActivityTimestampMs}b[2]!==k||b[3]!==g||b[4]!==h||b[5]!==a.lastActivityTimestampMs?(l=function(){g&&!k&&h!=null&&(i||(i=d("I64"))).gt(h.lastActivityTimestampMs,a.lastActivityTimestampMs)&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_TC_MS5_OPEN_SNIPPET,key:"thread_not_bumped_on_open_activity"})},b[2]=k,b[3]=g,b[4]=h,b[5]=a.lastActivityTimestampMs,b[6]=l):l=b[6];var m;b[7]!==k||b[8]!==g||b[9]!==h||b[10]!==a.lastActivityTimestampMs||b[11]!==a.threadKey?(m=[g,k,h,a.lastActivityTimestampMs,a.threadKey],b[7]=k,b[8]=g,b[9]=h,b[10]=a.lastActivityTimestampMs,b[11]=a.threadKey,b[12]=m):m=b[12];j(l,m);l=!1;if(g&&!k&&h!=null&&(i||(i=d("I64"))).gt(h.lastActivityTimestampMs,f)){m=h.snippet;f=h.lastMessageCtaType;var n;b[13]!==f||b[14]!==m?(n={isOpenThreadSnippet:!0,lastMessageCtaType:f,shouldHideTimestamp:!1,snippet:m},b[13]=f,b[14]=m,b[15]=n):n=b[15];return n}g&&(l=e.shouldHideTimestamp);m=g?e.snippet:a.snippet;f=a.lastMessageCtaType;if(g&&(m===""||m==null)){b[16]!==k?(n=p(k),b[16]=k,b[17]=n):n=b[17];return n}b[18]!==f||b[19]!==l||b[20]!==m?(e={lastMessageCtaType:f,shouldHideTimestamp:l,snippet:m},b[18]=f,b[19]=l,b[20]=m,b[21]=e):e=b[21];return e}var l=d("MAWAdminMsg").buildLocalizedString([],[],d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION),m=d("MAWAdminMsgCTA").getCtaTypeByAdminType(d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION),n=d("MAWAdminMsg").buildLocalizedString([],[],d("MAWLocalizationType").LOCALIZATION_TYPE.DUAL_THREAD_CUTOVER_ADMIN_MESSAGE),o=d("MAWAdminMsgCTA").getCtaTypeByAdminType(d("MAWLocalizationType").LOCALIZATION_TYPE.DUAL_THREAD_CUTOVER_ADMIN_MESSAGE);function p(a){var b;a?(a=n,b=o):(a=l,b=m);return{lastMessageCtaType:b,shouldHideTimestamp:!1,snippet:a}}function q(a){a?(d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_TC_MS5_OPEN_SNIPPET,key:"default_dual_thread_cutover_snippet"}),c("FBLogger")("messenger_web").info("Default dual thread cutover snippet used for secure thread")):d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_TC_MS5_OPEN_SNIPPET,key:"default_e2ee_thread_snippet"})}g["default"]=a}),98);
__d("usePresenceUnifiedIsThreadActive",["FBLogger","I64","Int64Hooks","MWPActor.react","PresenceCommonPresenceCommonTypes","ReQL","promiseDone","react","useAsyncReStore","usePresenceUnifiedClientContext","usePresenceUnifiedMapContext"],(function(a,b,c,d,e,f,g){"use strict";var h,i;b=h||d("react");var j=b.useEffect,k=b.useState;function a(a){var b=c("useAsyncReStore")(),e=d("MWPActor.react").useActor(),f=d("usePresenceUnifiedMapContext").usePresenceUnifiedMapContext(),g=d("usePresenceUnifiedClientContext").usePresenceUnifiedClientContext(),h=k(!1),l=h[0],m=h[1],n=d("Int64Hooks").useCallbackInt64(async function(){var c=await b;return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(c.tables.participants,["contactId"]).getKeyRange(a).filter(function(a){a=a.contactId;return!(i||(i=d("I64"))).equal(a,e)}).map(function(a){a=a.contactId;return(i||(i=d("I64"))).to_string(a)}))},[e,b,a]);j(function(){var a=async function(){var a=await n();g==null?void 0:g.addAdditionalContacts(a)};c("promiseDone")(a())},[]);j(function(){var a=async function(){if(g==null){c("FBLogger")("messenger_presence_web").warn("usePresenceUnifiedIsThreadActive must have a backing PresenceUnifiedClient");return}var a=await n();a=a.some(function(a){return((a=f.get(a))==null?void 0:a.presenceStatus)===d("PresenceCommonPresenceCommonTypes").PresenceStatus.Active});m(a)};c("promiseDone")(a())},[n,g,f]);return l}g.default=a}),98);